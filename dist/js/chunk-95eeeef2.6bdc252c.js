(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-95eeeef2"],{"0f9a":function(t,e,i){"use strict";i.d(e,"a",(function(){return a})),i.d(e,"b",(function(){return o}));var n=i("6682"),s=i("6ac9");class a{constructor(t){this.node=t,this.mindMap=t.mindMap}getShapePadding(t,e,i,n){const a=this.node.getShape(),o=15,d=5,h=t+2*i,r=e+2*n,l=Math.abs(h-r);switch(a){case s["a"].SHAPE.ROUNDED_RECTANGLE:return{paddingX:e>t?(e-t)/2:0,paddingY:0};case s["a"].SHAPE.DIAMOND:return{paddingX:t/2,paddingY:e/2};case s["a"].SHAPE.PARALLELOGRAM:return{paddingX:i<=0?o:0,paddingY:0};case s["a"].SHAPE.OUTER_TRIANGULAR_RECTANGLE:return{paddingX:i<=0?o:0,paddingY:0};case s["a"].SHAPE.INNER_TRIANGULAR_RECTANGLE:return{paddingX:i<=0?o:0,paddingY:0};case s["a"].SHAPE.ELLIPSE:return{paddingX:i<=0?o:0,paddingY:n<=0?d:0};case s["a"].SHAPE.CIRCLE:return{paddingX:r>h?l/2:0,paddingY:r<h?l/2:0}}const c=this.getShapeFromExtendList(a);return c&&c.getPadding({node:this.node,width:t,height:e,paddingX:i,paddingY:n})||{paddingX:0,paddingY:0}}getShapeFromExtendList(t){return this.mindMap.extendShapeList.find(e=>e.name===t)}createShape(){const t=this.node.getShape();let e=null;if(t===s["a"].SHAPE.RECTANGLE?e=this.createRect():t===s["a"].SHAPE.DIAMOND?e=this.createDiamond():t===s["a"].SHAPE.PARALLELOGRAM?e=this.createParallelogram():t===s["a"].SHAPE.ROUNDED_RECTANGLE?e=this.createRoundedRectangle():t===s["a"].SHAPE.OCTAGONAL_RECTANGLE?e=this.createOctagonalRectangle():t===s["a"].SHAPE.OUTER_TRIANGULAR_RECTANGLE?e=this.createOuterTriangularRectangle():t===s["a"].SHAPE.INNER_TRIANGULAR_RECTANGLE?e=this.createInnerTriangularRectangle():t===s["a"].SHAPE.ELLIPSE?e=this.createEllipse():t===s["a"].SHAPE.CIRCLE&&(e=this.createCircle()),!e){const i=this.getShapeFromExtendList(t);i&&(e=i.createShape(this.node))}return e||this.createRect()}getNodeSize(){const t=this.node.getBorderWidth();let{width:e,height:i}=this.node;return e-=t,i-=t,{width:e,height:i}}createPath(t){const{customCreateNodePath:e}=this.mindMap.opt;return e?Object(n["i"])(e(t)):(new n["f"]).plot(t)}createPolygon(t){const{customCreateNodePolygon:e}=this.mindMap.opt;return e?Object(n["i"])(e(t)):(new n["g"]).plot(t)}createRect(){let{width:t,height:e}=this.getNodeSize(),i=this.node.style.merge("borderRadius");const n=`\n      M${i},0\n      L${t-i},0\n      C${t-i},0 ${t},0 ${t},${i}\n      L${t},${e-i}\n      C${t},${e-i} ${t},${e} ${t-i},${e}\n      L${i},${e}\n      C${i},${e} 0,${e} 0,${e-i}\n      L0,${i}\n      C0,${i} 0,0 ${i},0\n      Z\n    `;return this.createPath(n)}createDiamond(){let{width:t,height:e}=this.getNodeSize(),i=t/2,n=e/2,s=i,a=0,o=t,d=n,h=i,r=e,l=0,c=n;const m=[[s,a],[o,d],[h,r],[l,c]];return this.createPolygon(m)}createParallelogram(){let{paddingX:t}=this.node.getPaddingVale();t=t||this.node.shapePadding.paddingX;let{width:e,height:i}=this.getNodeSize();const n=[[t,0],[e,0],[e-t,i],[0,i]];return this.createPolygon(n)}createRoundedRectangle(){let{width:t,height:e}=this.getNodeSize(),i=e/2;const n=`\n      M${i},0\n      L${t-i},0\n      A${e/2},${e/2} 0 0,1 ${t-i},${e} \n      L${i},${e}\n      A${e/2},${e/2} 0 0,1 ${i},0\n    `;return this.createPath(n)}createOctagonalRectangle(){let t=5,{width:e,height:i}=this.getNodeSize();const n=[[0,t],[t,0],[e-t,0],[e,t],[e,i-t],[e-t,i],[t,i],[0,i-t]];return this.createPolygon(n)}createOuterTriangularRectangle(){let{paddingX:t}=this.node.getPaddingVale();t=t||this.node.shapePadding.paddingX;let{width:e,height:i}=this.getNodeSize();const n=[[t,0],[e-t,0],[e,i/2],[e-t,i],[t,i],[0,i/2]];return this.createPolygon(n)}createInnerTriangularRectangle(){let{paddingX:t}=this.node.getPaddingVale();t=t||this.node.shapePadding.paddingX;let{width:e,height:i}=this.getNodeSize();const n=[[0,0],[e,0],[e-t/2,i/2],[e,i],[0,i],[t/2,i/2]];return this.createPolygon(n)}createEllipse(){let{width:t,height:e}=this.getNodeSize(),i=t/2,n=e/2;const s=`\n      M${i},0\n      A${i},${n} 0 0,1 ${i},${e} \n      M${i},${e} \n      A${i},${n} 0 0,1 ${i},0 \n    `;return this.createPath(s)}createCircle(){let{width:t,height:e}=this.getNodeSize(),i=t/2,n=e/2;const s=`\n      M${i},0\n      A${i},${n} 0 0,1 ${i},${e} \n      M${i},${e} \n      A${i},${n} 0 0,1 ${i},0 \n    `;return this.createPath(s)}}const o=[s["a"].SHAPE.RECTANGLE,s["a"].SHAPE.DIAMOND,s["a"].SHAPE.PARALLELOGRAM,s["a"].SHAPE.ROUNDED_RECTANGLE,s["a"].SHAPE.OCTAGONAL_RECTANGLE,s["a"].SHAPE.OUTER_TRIANGULAR_RECTANGLE,s["a"].SHAPE.INNER_TRIANGULAR_RECTANGLE,s["a"].SHAPE.ELLIPSE,s["a"].SHAPE.CIRCLE]},"50c9":function(t,e,i){"use strict";var n=i("a751"),s=i("0f9a"),a=i("6682"),o=i("d17d");function d(){const t=this.getData("generalization");return Array.isArray(t)?t:t?[t]:[]}function h(){return this.formatGetGeneralization().length>0}function r(){const t=this.formatGetGeneralization();return!!t.find(t=>!t.range||t.range.length<=0)}function l(t){return this._generalizationList.findIndex(e=>e.generalizationNode.uid===t.uid)}function c(){if(this.isGeneralization||!this.checkHasGeneralization())return;let t=0,e=0;const i=this.formatGetGeneralization();i.forEach((i,n)=>{let s=this._generalizationList[n];s||(s=this._generalizationList[n]={}),s.node=this,s.range=i.range,s.generalizationLine||(s.generalizationLine=this.lineDraw.path()),s.generalizationNode||(s.generalizationNode=new Bt({data:{inserting:i.inserting,data:i},uid:Object(o["r"])(),renderer:this.renderer,mindMap:this.mindMap,isGeneralization:!0})),delete i.inserting,s.generalizationNode.generalizationBelongNode=this,s.generalizationNode.width>t&&(t=s.generalizationNode.width),s.generalizationNode.height>e&&(e=s.generalizationNode.height),i.isActive&&this.renderer.addNodeToActiveList(s.generalizationNode)}),this._generalizationNodeWidth=t,this._generalizationNodeHeight=e}function m(){this.isGeneralization||(this.removeGeneralization(),this.createGeneralizationNode())}function p(t){if(this.isGeneralization)return;this.updateGeneralizationData();const e=this.formatGetGeneralization();e.length<=0||!1===this.getData("expand")?this.removeGeneralization():(e.length!==this._generalizationList.length&&this.removeGeneralization(),this.createGeneralizationNode(),this.renderer.layout.renderGeneralization(this._generalizationList),this._generalizationList.forEach(e=>{this.style.generalizationLine(e.generalizationLine),e.generalizationNode.render(()=>{},t)}))}function g(){const t=this.getChildrenLength(),e=this.formatGetGeneralization(),i=[];e.forEach(e=>{e.range?e.range.length>0&&e.range[0]<=t-1&&e.range[1]<=t-1&&i.push(e):i.push(e)}),i.length!==e.length&&this.setData({generalization:i})}function u(){this.isGeneralization||(this._generalizationList.forEach(t=>{t.generalizationNode.style.onRemove(),t.generalizationLine&&(t.generalizationLine.remove(),t.generalizationLine=null),t.generalizationNode&&(this.renderer.removeNodeFromActiveList(t.generalizationNode),t.generalizationNode.remove(),t.generalizationNode=null)}),this._generalizationList=[],this.generalizationBelongNode&&this.nodeDraw.find(".generalization_"+this.generalizationBelongNode.uid).remove())}function x(){this.isGeneralization||this._generalizationList.forEach(t=>{t.generalizationLine&&t.generalizationLine.hide(),t.generalizationNode&&t.generalizationNode.hide()})}function N(){this.isGeneralization||this._generalizationList.forEach(t=>{t.generalizationLine&&t.generalizationLine.show(),t.generalizationNode&&t.generalizationNode.show()})}function E(t){this._generalizationList.forEach(e=>{e.generalizationLine.opacity(t),e.generalizationNode.group.opacity(t)})}function f(){const t=this.generalizationBelongNode,e=t.formatGetGeneralization(),i=t.getGeneralizationNodeIndex(this),n=e[i],s=this.getStyle("hoverRectColor"),a=s||this.mindMap.opt.hoverRectColor,o=a?{stroke:a}:null;Array.isArray(n.range)&&n.range.length>0?this.mindMap.renderer.highlightNode(t,n.range,o):this.mindMap.renderer.highlightNode(t,null,o)}function _(){this.mindMap.renderer.closeHighlightNode()}var M={formatGetGeneralization:d,checkHasGeneralization:h,checkHasSelfGeneralization:r,getGeneralizationNodeIndex:l,createGeneralizationNode:c,updateGeneralization:m,updateGeneralizationData:g,renderGeneralization:p,removeGeneralization:u,hideGeneralization:x,showGeneralization:N,setGeneralizationOpacity:E,handleGeneralizationMouseenter:f,handleGeneralizationMouseleave:_},T=i("82df");function C(){if(this._openExpandNode)return;const{expandBtnSize:t,expandBtnIcon:e,isShowExpandNum:i}=this.mindMap.opt;let{close:n,open:s}=e||{};i?(this._openExpandNode=new a["j"],this._openExpandNode.addClass("smm-expand-btn-text"),this._openExpandNode.attr({"text-anchor":"middle","dominant-baseline":"middle",x:t/2,y:2})):(this._openExpandNode=Object(a["i"])(s||T["a"].open).size(t,t),this._openExpandNode.x(0).y(-t/2)),this._closeExpandNode=Object(a["i"])(n||T["a"].close).size(t,t),this._closeExpandNode.x(0).y(-t/2),this._fillExpandNode=(new a["b"]).size(t),this._fillExpandNode.x(0).y(-t/2),this.style.iconBtn(this._openExpandNode,this._closeExpandNode,this._fillExpandNode)}function y(t=[]){return t.reduce((t,e)=>t+this.sumNode(e.children||[]),t.length)}function v(){let t,{expand:e}=this.getData();if(e!==this._lastExpandBtnType&&(this._expandBtn&&this._expandBtn.clear(),this.createExpandNodeContent(),!1===e?(t=this._openExpandNode,this._lastExpandBtnType=!1):(t=this._closeExpandNode,this._lastExpandBtnType=!0),this._expandBtn)){let{isShowExpandNum:i,expandBtnStyle:n,expandBtnNumHandler:s}=this.mindMap.opt;if(i)if(e)this._fillExpandNode.stroke("none");else{this._fillExpandNode.stroke({color:n.strokeColor});let e=this.sumNode(this.nodeData.children||[]);if("function"===typeof s){const t=s(e,this);Object(o["bb"])(t)||(e=t)}t.text(String(e))}this._expandBtn.add(this._fillExpandNode).add(t)}}function D(){this._expandBtn&&this.renderer.layout.renderExpandBtn(this,this._expandBtn)}function b(){this.getChildrenLength()<=0||this.isRoot||(this._expandBtn||(this._expandBtn=new a["d"],this._expandBtn.on("mouseover",t=>{t.stopPropagation(),this._expandBtn.css({cursor:"pointer"})}),this._expandBtn.on("mouseout",t=>{t.stopPropagation(),this._expandBtn.css({cursor:"auto"})}),this._expandBtn.on("click",t=>{t.stopPropagation(),this.mindMap.execCommand("SET_NODE_EXPAND",this,!this.getData("expand")),this.mindMap.emit("expand_btn_click",this)}),this._expandBtn.on("dblclick",t=>{t.stopPropagation()}),this._expandBtn.addClass("smm-expand-btn")),this.group.add(this._expandBtn),this._showExpandBtn=!0,this.updateExpandBtnNode(),this.updateExpandBtnPos())}function w(){this._expandBtn&&this._showExpandBtn&&(this._expandBtn.remove(),this._showExpandBtn=!1)}function S(){const{alwaysShowExpandBtn:t,notShowExpandBtn:e}=this.mindMap.opt;t||e||setTimeout(()=>{this.renderExpandBtn()},0)}function L(){const{alwaysShowExpandBtn:t,notShowExpandBtn:e}=this.mindMap.opt;if(t||this._isMouseenter||e)return;let{isActive:i,expand:n}=this.getData();!i&&n&&setTimeout(()=>{this.removeExpandBtn()},0)}var A={createExpandNodeContent:C,updateExpandBtnNode:v,updateExpandBtnPos:D,renderExpandBtn:b,removeExpandBtn:w,showExpandBtn:S,hideExpandBtn:L,sumNode:y};function O(t={}){this.mindMap.execCommand("SET_NODE_DATA",this,t)}function R(t,e,i){this.mindMap.execCommand("SET_NODE_TEXT",this,t,e,i)}function k(t){this.mindMap.execCommand("SET_NODE_IMAGE",this,t)}function I(t){this.mindMap.execCommand("SET_NODE_ICON",this,t)}function z(t,e){this.mindMap.execCommand("SET_NODE_HYPERLINK",this,t,e)}function B(t){this.mindMap.execCommand("SET_NODE_NOTE",this,t)}function P(t,e){this.mindMap.execCommand("SET_NODE_ATTACHMENT",this,t,e)}function H(t){this.mindMap.execCommand("SET_NODE_TAG",this,t)}function G(t){this.mindMap.execCommand("SET_NODE_SHAPE",this,t)}function j(t,e){this.mindMap.execCommand("SET_NODE_STYLE",this,t,e)}function U(t){this.mindMap.execCommand("SET_NODE_STYLES",this,t)}var W={setData:O,setText:R,setImage:k,setIcon:I,setHyperlink:z,setNote:B,setAttachment:P,setTag:H,setShape:G,setStyle:j,setStyles:U},$=i("9b1e"),Y=i("6ac9");const X=(t,e)=>{const i=new a["d"],n=(new a["j"]).text(t);return e.text(n),i.add(n),i.bbox()},F={radius:3,fontSize:12,fill:"",height:20,paddingX:8};function V(){let t=this.getData("image");if(!t)return;t=(this.mindMap.renderer.renderTree.data.imgMap||{})[t]||t;const e=this.getImgShowSize(),i=(new a["e"]).load(t).size(...e),{defaultNodeImage:n}=this.mindMap.opt;if(n){const e=new Image;e.onerror=()=>{i.load(n)},e.src=t}return this.getData("imageTitle")&&i.attr("title",this.getData("imageTitle")),i.on("click",t=>{this.mindMap.emit("node_img_click",this,i,t)}),i.on("dblclick",t=>{this.mindMap.emit("node_img_dblclick",this,t,i)}),i.on("mouseenter",t=>{this.mindMap.emit("node_img_mouseenter",this,i,t)}),i.on("mouseleave",t=>{this.mindMap.emit("node_img_mouseleave",this,i,t)}),i.on("mousemove",t=>{this.mindMap.emit("node_img_mousemove",this,i,t)}),{node:i,width:e[0],height:e[1]}}function K(){const{custom:t,width:e,height:i}=this.getData("imageSize");return t?[e,i]:Object(o["pb"])(e,i,this.mindMap.themeConfig.imgMaxWidth,this.mindMap.themeConfig.imgMaxHeight)}function q(){let t=this.getData();if(!t.icon||t.icon.length<=0)return[];let e=this.mindMap.themeConfig.iconSize;return t.icon.map(t=>{let i=$["a"].getNodeIconListIcon(t,this.mindMap.opt.iconList||[]),n=null;return n=/^<svg/.test(i)?Object(a["i"])(i):(new a["e"]).load(i),n.size(e,e),n.on("click",e=>{this.mindMap.emit("node_icon_click",this,t,e,n)}),n.on("mouseenter",e=>{this.mindMap.emit("node_icon_mouseenter",this,t,e,n)}),n.on("mouseleave",e=>{this.mindMap.emit("node_icon_mouseleave",this,t,e,n)}),{node:n,width:e,height:e}})}function Q(t){const e=this.hasCustomWidth();let i="string"===typeof t?t:this.getData("text"),{textAutoWrapWidth:n,emptyTextMeasureHeightText:s}=this.mindMap.opt;n=e?this.customTextWidth:n;const d=new a["d"];let h=!1;this.getData("resetRichText")&&(delete this.nodeData.data.resetRichText,h=!0),h&&!Object(o["bb"])(i)&&(i=Object(o["h"])(i)?Object(o["nb"])(i):`<p>${i}</p>`,this.setData({text:i}));const r=[],l=Object(o["J"])(this);Object.keys(l).forEach(t=>{r.push([t,l[t]])}),this.mindMap.commonCaches.measureRichtextNodeTextSizeEl||(this.mindMap.commonCaches.measureRichtextNodeTextSizeEl=document.createElement("div"),this.mindMap.commonCaches.measureRichtextNodeTextSizeEl.style.position="fixed",this.mindMap.commonCaches.measureRichtextNodeTextSizeEl.style.left="-999999px",this.mindMap.el.appendChild(this.mindMap.commonCaches.measureRichtextNodeTextSizeEl));const c=this.mindMap.commonCaches.measureRichtextNodeTextSizeEl;r.forEach(([t,e])=>{c.style[t]=e}),c.style.lineHeight=1.2;const m=`<div>${i}</div>`;c.innerHTML=m;const p=c.children[0];p.classList.add("smm-richtext-node-wrap"),Object(o["b"])(p),p.style.maxWidth=n+"px",p.style.width=e?this.customTextWidth+"px":"";let{width:g,height:u}=p.getBoundingClientRect();if(u<=0){c.innerHTML=`<p>${s}</p>`;let t=c.children[0];t.classList.add("smm-richtext-node-wrap"),u=t.getBoundingClientRect().height,c.innerHTML=m}g=Math.min(Math.ceil(g)+1,n),u=Math.ceil(u),d.attr("data-width",g),d.attr("data-height",u);const x=Object(o["p"])({el:c.children[0],width:g,height:u}),N={"line-height":1.2};return r.forEach(([t,e])=>{N[Object(o["e"])(t)]=e}),x.css(N),d.add(x),{node:d,nodeContent:x,width:g,height:u}}function Z(t){if(this.getData("needUpdate")&&delete this.nodeData.data.needUpdate,this.getData("richText"))return this.createRichTextNode(t);const e="string"===typeof t?t:this.getData("text");this.getData("resetRichText")&&delete this.nodeData.data.resetRichText;const i=new a["d"],n=this.getStyle("fontSize",!1),s=this.getStyle("textAlign",!1);let d=[];Object(o["bb"])(e)||(d=String(e).split(/\n/gim));const{textAutoWrapWidth:h,emptyTextMeasureHeightText:r}=this.mindMap.opt;let l=d.length>1;d.forEach((t,e)=>{let i=t.split(""),n=[],s=[];while(i.length){let t=i.shift(),e=[...s,t].join("");X(e,this.style).width<=h?s.push(t):(n.push(s.join("")),s=[t])}s.length>0&&n.push(s.join("")),n.length>1&&(l=!0),d[e]=n.join("\n")}),d=d.join("\n").replace(/\n$/g,"").split(/\n/gim),d.forEach((t,e)=>{""===t&&(t="\ufeff");const o=(new a["j"]).text(t);o.addClass("smm-text-node-wrap"),o.attr("text-anchor",{left:"start",center:"middle",right:"end"}[s]||"start"),this.style.text(o),o.y(n*Y["g"]*e+(Y["g"]-1)*n/2),i.add(o)});let{width:c,height:m}=i.bbox();if(m<=0){const t=(new a["j"]).text(r);this.style.text(t);const e=t.bbox();m=e.height}return c=Math.min(Math.ceil(c),h),m=Math.ceil(m),i.attr("data-width",c),i.attr("data-height",m),i.attr("data-ismultiLine",l||d.length>1),{node:i,width:c,height:m}}function J(){const{hyperlink:t,hyperlinkTitle:e}=this.getData();if(!t)return;const{customHyperlinkJump:i,hyperlinkIcon:n}=this.mindMap.opt,{icon:s,style:o}=n,d=this.getNodeIconSize("hyperlinkIcon"),h=(new a["i"]).size(d,d),r=(new a["a"]).to(t).target("_blank");r.node.addEventListener("click",e=>{"function"===typeof i&&(e.preventDefault(),i(t,this))}),e&&h.add(Object(a["i"])(`<title>${e}</title>`)),r.rect(d,d).fill({color:"transparent"});const l=Object(a["i"])(s||$["a"].hyperlink).size(d,d);return this.style.iconNode(l,o.color),r.add(l),h.add(r),{node:h,width:d,height:d}}function tt(){const t=this.getData("tag");if(!t||t.length<=0)return[];let{maxTag:e,tagsColorMap:i}=this.mindMap.opt;i=i||{};const n=[];return t.slice(0,e).forEach((t,e)=>{let s="",d={...F};"string"===typeof t?s=t:(s=t.text,d={...F,...t.style});const h="undefined"!==typeof d.width,r=new a["d"];r.on("click",()=>{this.mindMap.emit("node_tag_click",this,t,e,r)});const l=(new a["j"]).text(s);this.style.tagText(l,d);const{width:c,height:m}=l.bbox(),p=h?d.width:c+2*d.paddingX,g=h?Math.max(p,c):p,u=Math.max(d.height,m);h?l.x((g-c)/2):l.x(h?0:d.paddingX),l.cy(-u/2);const x=(new a["h"]).size(p,d.height).cy(-u/2);h&&x.x((g-p)/2),this.style.tagRect(x,{...d,fill:d.fill||i[l.node.textContent]||Object(o["C"])(l.node.textContent)}),r.add(x).add(l),n.push({node:r,width:g,height:u})}),n}function et(){if(!this.getData("note"))return null;const{icon:t,style:e}=this.mindMap.opt.noteIcon,i=this.getNodeIconSize("noteIcon"),n=(new a["i"]).attr("cursor","pointer").addClass("smm-node-note").size(i,i);n.add((new a["h"]).size(i,i).fill({color:"transparent"}));const s=Object(a["i"])(t||$["a"].note).size(i,i);if(this.style.iconNode(s,e.color),n.add(s),!this.mindMap.opt.customNoteContentShow){if(!this.noteEl){this.noteEl=document.createElement("div"),this.noteEl.style.cssText=`\n          position: fixed;\n          padding: 10px;\n          border-radius: 5px;\n          box-shadow: 0 2px 5px rgb(0 0 0 / 10%);\n          display: none;\n          background-color: #fff;\n          z-index: ${this.mindMap.opt.nodeNoteTooltipZIndex}\n      `;const t=this.mindMap.opt.customInnerElsAppendTo||document.body;t.appendChild(this.noteEl)}this.noteEl.innerText=this.getData("note")}return n.on("mouseover",()=>{const{left:t,top:e}=this.getNoteContentPosition();this.mindMap.opt.customNoteContentShow?this.mindMap.opt.customNoteContentShow.show(this.getData("note"),t,e,this):(this.noteEl.style.left=t+"px",this.noteEl.style.top=e+"px",this.noteEl.style.display="block")}),n.on("mouseout",()=>{this.mindMap.opt.customNoteContentShow?this.mindMap.opt.customNoteContentShow.hide():this.noteEl.style.display="none"}),n.on("click",t=>{this.mindMap.emit("node_note_click",this,t,n)}),n.on("dblclick",t=>{this.mindMap.emit("node_note_dblclick",this,t,n)}),{node:n,width:i,height:i}}function it(){const{attachmentUrl:t,attachmentName:e}=this.getData();if(!t)return;const i=this.getNodeIconSize("attachmentIcon"),{icon:n,style:s}=this.mindMap.opt.attachmentIcon,o=(new a["i"]).attr("cursor","pointer").size(i,i);e&&o.add(Object(a["i"])(`<title>${e}</title>`)),o.add((new a["h"]).size(i,i).fill({color:"transparent"}));const d=Object(a["i"])(n||$["a"].attachment).size(i,i);return this.style.iconNode(d,s.color),o.add(d),o.on("click",t=>{this.mindMap.emit("node_attachmentClick",this,t,o)}),o.on("contextmenu",t=>{this.mindMap.emit("node_attachmentContextmenu",this,t,o)}),{node:o,width:i,height:i}}function nt(t){const{style:e}=this.mindMap.opt[t];return Object(o["bb"])(e.size)?this.mindMap.themeConfig.iconSize:e.size}function st(){const t=this.getNodeIconSize("noteIcon"),{scaleY:e}=this.mindMap.view.getTransformData().transform,i=t*e;let{left:n,top:s}=this._noteData.node.node.getBoundingClientRect();return s+=i,{left:n,top:s}}function at(t){this.mindMap.commonCaches.measureCustomNodeContentSizeEl||(this.mindMap.commonCaches.measureCustomNodeContentSizeEl=document.createElement("div"),this.mindMap.commonCaches.measureCustomNodeContentSizeEl.style.cssText="\n      position: fixed;\n      left: -99999px;\n      top: -99999px;\n    ",this.mindMap.el.appendChild(this.mindMap.commonCaches.measureCustomNodeContentSizeEl)),this.mindMap.commonCaches.measureCustomNodeContentSizeEl.innerHTML="",this.mindMap.commonCaches.measureCustomNodeContentSizeEl.appendChild(t);let e=this.mindMap.commonCaches.measureCustomNodeContentSizeEl.getBoundingClientRect();return{width:e.width,height:e.height}}function ot(){return!!this._customNodeContent}var dt={createImgNode:V,getImgShowSize:K,createIconNode:q,createRichTextNode:Q,createTextNode:Z,createHyperlinkNode:J,createTagNode:tt,createNoteNode:et,createAttachmentNode:it,getNoteContentPosition:st,getNodeIconSize:nt,measureCustomNodeContentSize:at,isUseCustomNodeContent:ot};function ht(){if(this.getChildrenLength()<=0||this.isRoot)return;const{alwaysShowExpandBtn:t,notShowExpandBtn:e,expandBtnSize:i}=this.mindMap.opt;if(!t&&!e){let{width:t,height:e}=this;this._unVisibleRectRegionNode||(this._unVisibleRectRegionNode=new a["h"],this._unVisibleRectRegionNode.fill({color:"transparent"})),this.group.add(this._unVisibleRectRegionNode),this.renderer.layout.renderExpandBtnRect(this._unVisibleRectRegionNode,i,t,e,this)}}function rt(){this._unVisibleRectRegionNode&&(this._unVisibleRectRegionNode.remove(),this._unVisibleRectRegionNode=null)}function lt(){this.needRerenderExpandBtnPlaceholderRect&&(this.needRerenderExpandBtnPlaceholderRect=!1,this.renderExpandBtnPlaceholderRect()),this.getChildrenLength()>0?this._unVisibleRectRegionNode||this.renderExpandBtnPlaceholderRect():this._unVisibleRectRegionNode&&this.clearExpandBtnPlaceholderRect()}var ct={renderExpandBtnPlaceholderRect:ht,clearExpandBtnPlaceholderRect:rt,updateExpandBtnPlaceholderRect:lt};function mt(){this.checkEnableDragModifyNodeWidth()&&(this._dragHandleNodes=null,this.dragHandleWidth=4,this.dragHandleMousedownX=0,this.isDragHandleMousedown=!1,this.dragHandleIndex=0,this.dragHandleMousedownCustomTextWidth=0,this.dragHandleMousedownBodyCursor="",this.dragHandleMousedownLeft=0,this.onDragMousemoveHandle=this.onDragMousemoveHandle.bind(this),window.addEventListener("mousemove",this.onDragMousemoveHandle),this.onDragMouseupHandle=this.onDragMouseupHandle.bind(this),window.addEventListener("mouseup",this.onDragMouseupHandle),this.mindMap.on("node_mouseup",this.onDragMouseupHandle))}function pt(t){if(!this.isDragHandleMousedown)return;t.stopPropagation(),t.preventDefault();let{minNodeTextModifyWidth:e,maxNodeTextModifyWidth:i,isUseCustomNodeContent:n,customCreateNodeContent:s}=this.mindMap.opt;const a=n&&s&&this._customNodeContent;document.body.style.cursor="ew-resize",this.group.css({cursor:"ew-resize"});const{scaleX:o}=this.mindMap.draw.transform(),d=t.clientX-this.dragHandleMousedownX;let h=this.dragHandleMousedownCustomTextWidth+(0===this.dragHandleIndex?-d:d)/o;if(h=Math.max(h,e),-1!==i&&(h=Math.min(h,i)),!a&&this.getData("image")){const t=this.getImgShowSize();this._rectInfo.textContentWidth-this.customTextWidth+h<=t[0]&&(h=t[0]+this.customTextWidth-this._rectInfo.textContentWidth)}this.customTextWidth=h,0===this.dragHandleIndex&&(this.left=this.dragHandleMousedownLeft+d/o),this.reRender(a?[]:["text"],{ignoreUpdateCustomTextWidth:!0})}function gt(){this.isDragHandleMousedown&&(document.body.style.cursor=this.dragHandleMousedownBodyCursor,this.group.css({cursor:"default"}),this.isDragHandleMousedown=!1,this.dragHandleMousedownX=0,this.dragHandleIndex=0,this.dragHandleMousedownCustomTextWidth=0,this.setData({customTextWidth:this.customTextWidth}),this.mindMap.render(),this.mindMap.emit("dragModifyNodeWidthEnd",this))}function ut(){const t=[new a["h"],new a["h"]];return t.forEach((t,e)=>{t.size(this.dragHandleWidth,this.height).fill({color:"transparent"}).css({cursor:"ew-resize"}),t.on("mousedown",t=>{t.stopPropagation(),t.preventDefault(),this.dragHandleMousedownX=t.clientX,this.dragHandleIndex=e,this.dragHandleMousedownCustomTextWidth=void 0===this.customTextWidth?this._textData?this._textData.width:this.width:this.customTextWidth,this.dragHandleMousedownBodyCursor=document.body.style.cursor,this.dragHandleMousedownLeft=this.left,this.isDragHandleMousedown=!0})}),t}function xt(){this.checkEnableDragModifyNodeWidth()&&(this._dragHandleNodes||(this._dragHandleNodes=this.createDragHandleNode()),this.getData("isActive")?(this._dragHandleNodes.forEach(t=>{t.height(this.height),this.group.add(t)}),this._dragHandleNodes[1].x(this.width-this.dragHandleWidth)):this._dragHandleNodes.forEach(t=>{t.remove()}))}var Nt={initDragHandle:mt,onDragMousemoveHandle:pt,onDragMouseupHandle:gt,createDragHandleNode:ut,updateDragHandle:xt};function Et(){this.mindMap.cooperate&&(this._userListGroup=new a["d"],this.group.add(this._userListGroup))}function ft(t){const{avatarSize:e,fontSize:i}=this.mindMap.opt.cooperateStyle,n=new a["d"],s=t.isMore?t.name:String(t.name)[0],d=(new a["b"]).size(e,e);d.fill({color:t.color||Object(o["C"])(s)});const h=(new a["j"]).text(s).fill({color:"#fff"}).css({"font-size":i+"px"}).dx(-i/2).dy((e-i)/2);return n.add(d).add(h),n}function _t(t){const{avatarSize:e}=this.mindMap.opt.cooperateStyle;return(new a["e"]).load(t.avatar).size(e,e)}function Mt(){if(!this._userListGroup)return;const{avatarSize:t}=this.mindMap.opt.cooperateStyle;this._userListGroup.clear();const e=this.userList.length,i=Math.floor(this.width/t),n=[];e>i?n.push(...this.userList.slice(0,i-1),{isMore:!0,name:"+"+(e-i+1)}):n.push(...this.userList),n.forEach((e,i)=>{let n=null;n=e.avatar?this.createImageAvatar(e):this.createTextAvatar(e),n.on("click",t=>{this.mindMap.emit("node_cooperate_avatar_click",e,this,n,t)}),n.on("mouseenter",t=>{this.mindMap.emit("node_cooperate_avatar_mouseenter",e,this,n,t)}),n.on("mouseleave",t=>{this.mindMap.emit("node_cooperate_avatar_mouseleave",e,this,n,t)}),n.x(i*t).cy(-t/2),this._userListGroup.add(n)})}function Tt(t){this.userList.find(e=>e.id==t.id)||(this.userList.push(t),this.updateUserListNode())}function Ct(t){const e=this.userList.findIndex(e=>e.id==t.id);-1!==e&&(this.userList.splice(e,1),this.updateUserListNode())}function yt(){this.userList=[],this.updateUserListNode()}var vt={createUserListNode:Et,updateUserListNode:Mt,createTextAvatar:ft,createImageAvatar:_t,addUser:Tt,removeUser:Ct,emptyUser:yt};function Dt(){this.isGeneralization||(this._quickCreateChildBtn=null,this._showQuickCreateChildBtn=!1)}function bt(){if(!(this.isGeneralization||this.getChildrenLength()>0)){if(this._quickCreateChildBtn)this.group.add(this._quickCreateChildBtn);else{const{quickCreateChildBtnIcon:t,expandBtnStyle:e,expandBtnSize:i}=this.mindMap.opt,{icon:n,style:s}=t;let{color:o,fill:d}=e||{color:"#808080",fill:"#fff"};o=s.color||o;const h=Object(a["i"])(n||T["a"].quickCreateChild).size(i,i);h.css({cursor:"pointer"}),h.x(0).y(-i/2),this.style.iconNode(h,o);const r=(new a["b"]).size(i);r.x(0).y(-i/2),r.fill({color:d}).css({cursor:"pointer"}),this._quickCreateChildBtn=new a["d"],this._quickCreateChildBtn.add(r).add(h),this._quickCreateChildBtn.on("click",t=>{t.stopPropagation(),this.mindMap.emit("quick_create_btn_click",this);const{customQuickCreateChildBtnClick:e}=this.mindMap.opt;"function"!==typeof e?this.mindMap.execCommand("INSERT_CHILD_NODE",!0,[this]):e(this)}),this._quickCreateChildBtn.on("dblclick",t=>{t.stopPropagation()}),this._quickCreateChildBtn.addClass("smm-quick-create-child-btn"),this.group.add(this._quickCreateChildBtn)}this._showQuickCreateChildBtn=!0,this.renderer.layout.renderExpandBtn(this,this._quickCreateChildBtn)}}function wt(){this.isGeneralization||this._quickCreateChildBtn&&this._showQuickCreateChildBtn&&(this._quickCreateChildBtn.remove(),this._showQuickCreateChildBtn=!1)}function St(){if(this.isGeneralization)return;const{isActive:t}=this.getData();t||this.removeQuickCreateChildBtn()}var Lt={initQuickCreateChildBtn:Dt,showQuickCreateChildBtn:bt,removeQuickCreateChildBtn:wt,hideQuickCreateChildBtn:St};function At(t,e,i,n,s){const{imgTextMargin:a}=this.mindMap.opt;return"v"===t?n>0&&s>0?a:0:e>0&&i>0?a:0}function Ot(t){let e=0,i=this._tagData.reduce((t,i)=>(e=Math.max(e,i.height),t+i.width),0);return i+=(this._tagData.length-1)*t,{width:i,height:e}}function Rt(){if(this.isUseCustomNodeContent()){const t=this.measureCustomNodeContentSize(this._customNodeContent);return{width:this.hasCustomWidth()?this.customTextWidth:t.width,height:t.height}}const{TAG_PLACEMENT:t,IMG_PLACEMENT:e}=Y["a"],{textContentMargin:i}=this.mindMap.opt,n=this.getStyle("tagPlacement")||t.RIGHT,s=n===t.BOTTOM,a=this.getStyle("imgPlacement")||e.TOP;let o=0,d=0,h=0,r=0,l=0,c=0,m=0;if(this._imgData&&(o=this._imgData.width,d=this._imgData.height),this.mindMap.nodeInnerPrefixList.forEach(t=>{const e=this[`_${t.name}Data`];e&&(h+=e.width,r=Math.max(r,e.height),m++)}),this._prefixData&&(h+=this._prefixData.width,r=Math.max(r,this._prefixData.height),m++),this._iconData.length>0&&(h+=this._iconData.reduce((t,e)=>(r=Math.max(r,e.height),t+e.width),0)+(this._iconData.length-1)*i,m++),this._textData&&(h+=this._textData.width,r=Math.max(r,this._textData.height),m++),this._hyperlinkData&&(h+=this._hyperlinkData.width,r=Math.max(r,this._hyperlinkData.height),m++),this._tagData.length>0){const{width:t,height:e}=this.getTagContentSize(i);s?(l=t,c=e):(h+=t,r=Math.max(r,e),m++)}this._noteData&&(h+=this._noteData.width,r=Math.max(r,this._noteData.height),m++),this._attachmentData&&(h+=this._attachmentData.width,r=Math.max(r,this._attachmentData.height),m++),this._postfixData&&(h+=this._postfixData.width,r=Math.max(r,this._postfixData.height),m++),this.mindMap.nodeInnerPostfixList.forEach(t=>{const e=this[`_${t.name}Data`];e&&(h+=e.width,r=Math.max(r,e.height),m++)}),h+=(m-1)*i,s&&h>0&&c>0&&(this._rectInfo.textContentWidthWithoutTag=h,h=Math.max(h,l),r=r+i+c),this._rectInfo.textContentWidth=h,this._rectInfo.textContentHeight=r;let p=0,g=0;[e.TOP,e.BOTTOM].includes(a)?(p=Math.max(o,h),g=d+r+this.getImgTextMarin("v",0,0,d,r)):(p=o+h+this.getImgTextMarin("h",o,h),g=Math.max(d,r));const{paddingX:u,paddingY:x}=this.getPaddingVale(),{paddingX:N,paddingY:E}=this.shapeInstance.getShapePadding(p,g,u,x);this.shapePadding.paddingX=N,this.shapePadding.paddingY=E;const f=this.getBorderWidth();return{width:p+2*u+2*N+f,height:g+2*x+2*E+f}}function kt(){if(!this.group)return;this.group.clear();const{hoverRectPadding:t,openRealtimeRenderOnNodeTextEdit:e,textContentMargin:i,addCustomContentToNode:n}=this.mindMap.opt,{width:s,height:d}=this;let{paddingX:h,paddingY:r}=this.getPaddingVale();const l=this.getBorderWidth()/2;h+=this.shapePadding.paddingX+l,r+=this.shapePadding.paddingY+l,this.shapeNode=this.shapeInstance.createShape(),this.shapeNode.addClass("smm-node-shape"),this.shapeNode.translate(l,l),this.style.shape(this.shapeNode),this.group.add(this.shapeNode),this.renderExpandBtnPlaceholderRect(),this.createUserListNode&&this.createUserListNode(),this.isGeneralization&&this.generalizationBelongNode&&this.group.addClass("generalization_"+this.generalizationBelongNode.uid);const c=()=>{this.hoverNode=(new a["h"]).size(s+2*t,d+2*t).x(-t).y(-t),this.hoverNode.addClass("smm-hover-node"),this.style.hoverNode(this.hoverNode,s,d),this.group.add(this.hoverNode)};if(this.isUseCustomNodeContent()){const t=Object(o["p"])({el:this._customNodeContent,width:s,height:d});return this.group.add(t),void c()}const{IMG_PLACEMENT:m,TAG_PLACEMENT:p}=Y["a"],g=this.getStyle("imgPlacement")||m.TOP,u=this.getStyle("tagPlacement")||p.RIGHT,x=u===p.BOTTOM;let{textContentWidth:N,textContentHeight:E,textContentWidthWithoutTag:f}=this._rectInfo;const _=E;let M=0,T=0;const C=this._tagData&&this._tagData.length>0;if(C){const t=this.getTagContentSize(i);M=t.width,T=t.height,x&&(E-=T+i)}let y=0,v=0;if(this._imgData)switch(y=this._imgData.width,v=this._imgData.height,this.group.add(this._imgData.node),g){case m.TOP:this._imgData.node.cx(s/2).y(r);break;case m.BOTTOM:this._imgData.node.cx(s/2).y(d-r-v);break;case m.LEFT:this._imgData.node.x(h).cy(d/2);break;case m.RIGHT:this._imgData.node.x(s-h-y).cy(d/2);break;default:break}let D=new a["d"],b=0;if(C&&x&&(b=f<N?(N-f)/2:0),this.mindMap.nodeInnerPrefixList.forEach(t=>{const e=this[`_${t.name}Data`];e&&(e.node.x(b).y((E-e.height)/2),D.add(e.node),b+=e.width+i)}),this._prefixData){const t=Object(o["p"])({el:this._prefixData.el,width:this._prefixData.width,height:this._prefixData.height});t.x(b).y((E-this._prefixData.height)/2),D.add(t),b+=this._prefixData.width+i}let w=new a["d"];if(this._iconData&&this._iconData.length>0){let t=0;this._iconData.forEach(e=>{e.node.x(b+t).y((E-e.height)/2),w.add(e.node),t+=e.width+i}),D.add(w),b+=t}if(this._textData){const t=this._textData.node.attr("data-offsetx")||0;this._textData.node.attr("data-offsetx",b),(this._textData.nodeContent||this._textData.node).x(-t).x(b).y((E-this._textData.height)/2),e&&this._textData.node.opacity(this.mindMap.renderer.textEdit.getCurrentEditNode()===this?0:1),D.add(this._textData.node),b+=this._textData.width+i}this._hyperlinkData&&(this._hyperlinkData.node.x(b).y((E-this._hyperlinkData.height)/2),D.add(this._hyperlinkData.node),b+=this._hyperlinkData.width+i);let S=new a["d"];if(C)if(x){let t=0;this._tagData.forEach(e=>{e.node.x(t).y((T-e.height)/2),S.add(e.node),t+=e.width+i}),S.x((N-M)/2).y(_-T),D.add(S)}else{let t=0;this._tagData.forEach(e=>{e.node.x(b+t).y((E-e.height)/2),S.add(e.node),t+=e.width+i}),D.add(S),b+=t}if(this._noteData&&(this._noteData.node.x(b).y((E-this._noteData.height)/2),D.add(this._noteData.node),b+=this._noteData.width+i),this._attachmentData&&(this._attachmentData.node.x(b).y((E-this._attachmentData.height)/2),D.add(this._attachmentData.node),b+=this._attachmentData.width+i),this._postfixData){const t=Object(o["p"])({el:this._postfixData.el,width:this._postfixData.width,height:this._postfixData.height});t.x(b).y((E-this._postfixData.height)/2),D.add(t),b+=this._postfixData.width+i}this.mindMap.nodeInnerPostfixList.forEach(t=>{const e=this[`_${t.name}Data`];e&&(e.node.x(b).y((E-e.height)/2),D.add(e.node),b+=e.width+i)}),this.group.add(D);const{width:L,height:A}=D.bbox();let O=0,R=0;switch(g){case m.TOP:O=s/2-L/2,R=r+v+this.getImgTextMarin("v",0,0,v,_);break;case m.BOTTOM:O=s/2-L/2,R=r;break;case m.LEFT:O=y+h+this.getImgTextMarin("h",y,N),R=d/2-A/2;break;case m.RIGHT:O=h,R=d/2-A/2;break}if(D.translate(O,R),c(),this._customContentAddToNodeAdd&&this._customContentAddToNodeAdd.el){const t=Object(o["p"])(this._customContentAddToNodeAdd);this.group.add(t),n&&"function"===typeof n.handle&&n.handle({content:this._customContentAddToNodeAdd,element:t,node:this})}this.mindMap.emit("node_layout_end",this)}var It={getImgTextMarin:At,getTagContentSize:Ot,getNodeRect:Rt,layout:kt};class zt{constructor(t={}){this.opt=t,this.nodeData=this.handleData(t.data||{}),this.nodeDataSnapshot="",this.uid=t.uid,this.mindMap=t.mindMap,this.renderer=t.renderer,this.draw=this.mindMap.draw,this.nodeDraw=this.mindMap.nodeDraw,this.lineDraw=this.mindMap.lineDraw,this.style=new n["a"](this),this.effectiveStyles={},this.shapeInstance=new s["a"](this),this.shapePadding={paddingX:0,paddingY:0},this.isRoot=void 0!==t.isRoot&&t.isRoot,this.isGeneralization=void 0!==t.isGeneralization&&t.isGeneralization,this.generalizationBelongNode=null,this.layerIndex=void 0===t.layerIndex?0:t.layerIndex,this.width=t.width||0,this.height=t.height||0,this.customTextWidth=t.data.data.customTextWidth||void 0,this._left=t.left||0,this._top=t.top||0,this.customLeft=t.data.data.customLeft||void 0,this.customTop=t.data.data.customTop||void 0,this.isDrag=!1,this.parent=t.parent||null,this.children=t.children||[],this.userList=[],this.group=null,this.shapeNode=null,this.hoverNode=null,this._customNodeContent=null,this._imgData=null,this._iconData=null,this._textData=null,this._hyperlinkData=null,this._tagData=null,this._noteData=null,this.noteEl=null,this.noteContentIsShow=!1,this._attachmentData=null,this._prefixData=null,this._postfixData=null,this._expandBtn=null,this._lastExpandBtnType=null,this._showExpandBtn=!1,this._openExpandNode=null,this._closeExpandNode=null,this._fillExpandNode=null,this._userListGroup=null,this._lines=[],this._generalizationList=[],this._unVisibleRectRegionNode=null,this._isMouseenter=!1,this._customContentAddToNodeAdd=null,this._rectInfo={textContentWidth:0,textContentHeight:0,textContentWidthWithoutTag:0},this._generalizationNodeWidth=0,this._generalizationNodeHeight=0,this.expandBtnSize=this.mindMap.opt.expandBtnSize,this.isMultipleChoice=!1,this.needLayout=!1,this.isHide=!1;const e=Object.getPrototypeOf(this);e.bindEvent||(Object.keys(It).forEach(t=>{e[t]=It[t]}),Object.keys(M).forEach(t=>{e[t]=M[t]}),Object.keys(A).forEach(t=>{e[t]=A[t]}),Object.keys(ct).forEach(t=>{e[t]=ct[t]}),Object.keys(W).forEach(t=>{e[t]=W[t]}),Object.keys(dt).forEach(t=>{e[t]=dt[t]}),this.mindMap.cooperate&&Object.keys(vt).forEach(t=>{e[t]=vt[t]}),Object.keys(Nt).forEach(t=>{e[t]=Nt[t]}),this.mindMap.opt.isShowCreateChildBtnIcon&&(Object.keys(Lt).forEach(t=>{e[t]=Lt[t]}),this.initQuickCreateChildBtn()),e.bindEvent=!0),this.getSize(),this.updateGeneralization(),this.initDragHandle()}get left(){return this.customLeft||this._left}set left(t){this._left=t}get top(){return this.customTop||this._top}set top(t){this._top=t}reset(){this.children=[],this.parent=null,this.isRoot=!1,this.layerIndex=0,this.left=0,this.top=0}resetWhenDelete(){this._isMouseenter=!1}handleData(t){return t.data.expand=!1!==t.data.expand,t.data.isActive=!0===t.data.isActive,t.children=t.children||[],t}createNodeData(t){const{isUseCustomNodeContent:e,customCreateNodeContent:i,createNodePrefixContent:n,createNodePostfixContent:s,addCustomContentToNode:a}=this.mindMap.opt,d=["custom","image","icon","text","hyperlink","tag","note","attachment","prefix","postfix",...this.mindMap.nodeInnerPrefixList.map(t=>t.name),...this.mindMap.nodeInnerPostfixList.map(t=>t.name)],h={};Array.isArray(t)?d.forEach(e=>{t.includes(e)&&(h[e]=!0)}):d.forEach(t=>{h[t]=!0}),e&&i&&h.custom&&(this._customNodeContent=i(this)),this._customNodeContent?Object(o["b"])(this._customNodeContent):(h.image&&(this._imgData=this.createImgNode()),h.icon&&(this._iconData=this.createIconNode()),h.text&&(this._textData=this.createTextNode()),h.hyperlink&&(this._hyperlinkData=this.createHyperlinkNode()),h.tag&&(this._tagData=this.createTagNode()),h.note&&(this._noteData=this.createNoteNode()),h.attachment&&(this._attachmentData=this.createAttachmentNode()),this.mindMap.nodeInnerPrefixList.forEach(t=>{h[t.name]&&(this[`_${t.name}Data`]=t.createContent(this))}),h.prefix&&(this._prefixData=n?n(this):null,this._prefixData&&this._prefixData.el&&Object(o["b"])(this._prefixData.el)),h.postfix&&(this._postfixData=s?s(this):null,this._postfixData&&this._postfixData.el&&Object(o["b"])(this._postfixData.el)),this.mindMap.nodeInnerPostfixList.forEach(t=>{h[t.name]&&(this[`_${t.name}Data`]=t.createContent(this))}),a&&"function"===typeof a.create&&(this._customContentAddToNodeAdd=a.create(this),this._customContentAddToNodeAdd&&this._customContentAddToNodeAdd.el&&Object(o["b"])(this._customContentAddToNodeAdd.el)))}getSize(t,e={}){const i=e.ignoreUpdateCustomTextWidth||!1;i||(this.customTextWidth=this.getData("customTextWidth")||void 0),this.customLeft=this.getData("customLeft")||void 0,this.customTop=this.getData("customTop")||void 0,this.createNodeData(t);const{width:n,height:s}=this.getNodeRect(),a=this.width!==n||this.height!==s;return this.width=n,this.height=s,a}bindGroupEvent(){this.group.on("click",t=>{if(this.mindMap.emit("node_click",this,t),this.isMultipleChoice)return t.stopPropagation(),void(this.isMultipleChoice=!1);this.mindMap.opt.onlyOneEnableActiveNodeOnCooperate&&this.userList.length>0||this.active(t)}),this.group.on("mousedown",t=>{const{readonly:e,enableCtrlKeyNodeSelection:i,useLeftKeySelectionRightKeyDrag:n,mousedownEventPreventDefault:s}=this.mindMap.opt;if(s&&t.preventDefault(),e||(this.isRoot?3!==t.which||n||t.stopPropagation():2!==t.which&&t.stopPropagation()),!e&&(t.ctrlKey||t.metaKey)&&i){this.isMultipleChoice=!0;const t=this.getData("isActive");t||this.mindMap.emit("before_node_active",this,this.renderer.activeNodeList),this.mindMap.renderer[t?"removeNodeFromActiveList":"addNodeToActiveList"](this,!0),this.renderer.emitNodeActiveEvent(t?null:this)}this.mindMap.emit("node_mousedown",this,t)}),this.group.on("mouseup",t=>{this.isRoot||2===t.which||this.mindMap.opt.readonly||t.stopPropagation(),this.mindMap.emit("node_mouseup",this,t)}),this.group.on("mouseenter",t=>{this.isDrag||(this._isMouseenter=!0,this.showExpandBtn(),this.isGeneralization&&this.handleGeneralizationMouseenter(),this.mindMap.emit("node_mouseenter",this,t))}),this.group.on("mouseleave",t=>{this._isMouseenter&&(this._isMouseenter=!1,this.hideExpandBtn(),this.isGeneralization&&this.handleGeneralizationMouseleave(),this.mindMap.emit("node_mouseleave",this,t))}),this.group.on("dblclick",t=>{const{readonly:e,onlyOneEnableActiveNodeOnCooperate:i}=this.mindMap.opt;e||t.ctrlKey||t.metaKey||(t.stopPropagation(),i&&this.userList.length>0||this.mindMap.emit("node_dblclick",this,t))}),this.group.on("contextmenu",t=>{const{readonly:e,useLeftKeySelectionRightKeyDrag:i}=this.mindMap.opt;e||t.ctrlKey||(t.stopPropagation(),t.preventDefault(),this.mindMap.select&&!i&&this.mindMap.select.hasSelectRange()||(this.getData("isActive")&&1===this.renderer.activeNodeList.length||(this.renderer.clearActiveNodeList(),this.active(t)),this.mindMap.emit("node_contextmenu",t,this)))})}active(t){this.mindMap.opt.readonly||(t&&t.stopPropagation(),this.getData("isActive")||(this.mindMap.emit("before_node_active",this,this.renderer.activeNodeList),this.renderer.clearActiveNodeList(),this.renderer.addNodeToActiveList(this,!0),this.renderer.emitNodeActiveEvent(this)))}deactivate(){this.mindMap.renderer.removeNodeFromActiveList(this),this.mindMap.renderer.emitNodeActiveEvent()}update(t){if(!this.group)return;this.updateNodeActiveClass();const{alwaysShowExpandBtn:e,notShowExpandBtn:i,isShowCreateChildBtnIcon:n,readonly:s}=this.mindMap.opt,a=this.getChildrenLength();if(!i)if(e)this._expandBtn&&a<=0?this.removeExpandBtn():this.renderExpandBtn();else{const{isActive:t,expand:e}=this.getData();a<=0?this.removeExpandBtn():!e||t||this._isMouseenter?this.showExpandBtn():this.hideExpandBtn()}if(n)if(a>0)this.removeQuickCreateChildBtn();else{const{isActive:t}=this.getData();t?this.showQuickCreateChildBtn():this.hideQuickCreateChildBtn()}this.updateDragHandle(),this.renderGeneralization(t),this.updateUserListNode&&this.updateUserListNode();const o=this.group.transform();this.nodeDataSnapshot=s?"":JSON.stringify(this.getData()),this.left===o.translateX&&this.top===o.translateY||this.group.translate(this.left-o.translateX,this.top-o.translateY)}getNodePosInClient(t,e){const i=this.mindMap.draw.transform(),{scaleX:n,scaleY:s,translateX:a,translateY:o}=i,d=t*n+a,h=e*s+o;return{left:d,top:h}}checkIsInClient(t=0){const{left:e,top:i}=this.getNodePosInClient(this.left,this.top);return e+this.width>0-t&&i+this.height>0-t&&e<this.mindMap.width+t&&i<this.mindMap.height+t}reRender(t,e){const i=this.getSize(t,e);return this.layout(),this.update(),i}updateNodeActiveClass(){if(!this.group)return;const t=this.getData("isActive");this.group[t?"addClass":"removeClass"]("active")}updateNodeByActive(t){if(this.group){const{isShowCreateChildBtnIcon:e}=this.mindMap.opt;t?(this.showExpandBtn(),e&&this.showQuickCreateChildBtn()):(this.hideExpandBtn(),e&&this.hideQuickCreateChildBtn()),this.updateNodeActiveClass(),this.updateDragHandle()}}render(t=(()=>{}),e=!1,i=!1){this.renderLine();const{openPerformance:n,performanceConfig:s}=this.mindMap.opt;if(e||!n||this.checkIsInClient(s.padding)||this.isRoot?this.group?(this.nodeDraw.has(this.group)||this.nodeDraw.add(this.group),this.needLayout&&(this.needLayout=!1,this.layout()),this.updateExpandBtnPlaceholderRect(),this.update(e)):(this.group=new a["d"],this.group.addClass("smm-node"),this.group.css({cursor:"default"}),this.bindGroupEvent(),this.nodeDraw.add(this.group),this.layout(),this.update(e)):n&&s.removeNodeWhenOutCanvas&&this.removeSelf(),this.children&&this.children.length&&!1!==this.getData("expand")){let n=0;this.children.forEach(s=>{const a=()=>{s.render(()=>{n++,n>=this.children.length&&t()},e,i)};i?setTimeout(a,0):a()})}else t();this.nodeData.inserting&&(delete this.nodeData.inserting,this.active(),this.mindMap.emit("node_dblclick",this,null,!0))}removeSelf(){this.group&&(this.group.remove(),this.removeGeneralization())}remove(){this.group&&(this.group.remove(),this.removeGeneralization(),this.removeLine(),this.children&&this.children.length&&this.children.forEach(t=>{t.remove()}))}destroy(){this.removeLine(),this.parent&&this.parent.removeLine(),this.group&&(this.emptyUser&&this.emptyUser(),this.resetWhenDelete(),this.group.remove(),this.removeGeneralization(),this.group=null,this.style.onRemove())}hide(){if(this.group&&this.group.hide(),this.hideGeneralization(),this.parent){const t=this.parent.children.indexOf(this);this.parent._lines[t]&&this.parent._lines[t].hide(),this._lines.forEach(t=>{t.hide()})}this.children&&this.children.length&&this.children.forEach(t=>{t.hide()})}show(){if(this.group){if(this.group.show(),this.showGeneralization(),this.parent){const t=this.parent.children.indexOf(this);this.parent._lines[t]&&this.parent._lines[t].show(),this._lines.forEach(t=>{t.show()})}this.children&&this.children.length&&this.children.forEach(t=>{t.show()})}}setOpacity(t){this.group&&this.group.opacity(t),this._lines.forEach(e=>{e.opacity(t)}),this.children.forEach(e=>{e.setOpacity(t)}),this.setGeneralizationOpacity(t)}hideChildren(){this._lines.forEach(t=>{t.hide()}),this.children&&this.children.length&&this.children.forEach(t=>{t.hide()})}showChildren(){this._lines.forEach(t=>{t.show()}),this.children&&this.children.length&&this.children.forEach(t=>{t.show()})}startDrag(){this.isDrag=!0,this.group&&this.group.addClass("smm-node-dragging")}endDrag(){this.isDrag=!1,this.group&&this.group.removeClass("smm-node-dragging")}renderLine(t=!1){if(!1===this.getData("expand"))return;let e=this.getChildrenLength();this.mindMap.renderer.layout.nodeIsRemoveAllLines&&this.mindMap.renderer.layout.nodeIsRemoveAllLines(this)&&(e=0),e>this._lines.length?new Array(e-this._lines.length).fill(0).forEach(()=>{this._lines.push(this.lineDraw.path())}):e<this._lines.length&&(this._lines.slice(e).forEach(t=>{t.remove()}),this._lines=this._lines.slice(0,e)),this.renderer.layout.renderLine(this,this._lines,(...t)=>{this.styleLine(...t)},this.style.getStyle("lineStyle",!0)),t&&this.children&&this.children.length>0&&this.children.forEach(e=>{e.renderLine(t)})}getShape(){return this.mindMap.themeConfig.nodeUseLineStyle?Y["a"].SHAPE.RECTANGLE:this.style.getStyle("shape",!1,!1)}hasCustomPosition(){return void 0!==this.customLeft&&void 0!==this.customTop}ancestorHasCustomPosition(){let t=this;while(t){if(t.hasCustomPosition())return!0;t=t.parent}return!1}ancestorHasGeneralization(){let t=this.parent;while(t){if(t.checkHasGeneralization())return!0;t=t.parent}return!1}addChildren(t){this.children.push(t)}styleLine(t,e,i){const{enableInheritAncestorLineStyle:n}=this.mindMap.opt,s=n?"getSelfInhertStyle":"getSelfStyle",a=e[s]("lineWidth")||e.getStyle("lineWidth",!0),o=e[s]("lineColor")||this.getRainbowLineColor(e)||e.getStyle("lineColor",!0),d=e[s]("lineDasharray")||e.getStyle("lineDasharray",!0);this.style.line(t,{width:a,color:o,dasharray:d},i,e)}getRainbowLineColor(t){return this.mindMap.rainbowLines?this.mindMap.rainbowLines.getNodeColor(t):""}removeLine(){this._lines.forEach(t=>{t.remove()}),this._lines=[]}isAncestor(t){if(this.uid===t.uid)return!1;let e=t.parent;while(e){if(this.uid===e.uid)return!0;e=e.parent}return!1}isParent(t){if(this.uid===t.uid)return!1;const e=t.parent;return!(!e||this.uid!==e.uid)}isBrother(t){return!(!this.parent||this.uid===t.uid)&&this.parent.children.find(e=>e.uid===t.uid)}getIndexInBrothers(){return this.parent&&this.parent.children?this.parent.children.findIndex(t=>t.uid===this.uid):-1}getPaddingVale(){return{paddingX:this.getStyle("paddingX"),paddingY:this.getStyle("paddingY")}}getStyle(t,e){const i=this.style.merge(t,e);return void 0===i?"":i}getSelfStyle(t){return this.style.getSelfStyle(t)}getParentSelfStyle(t){return this.parent?this.parent.getSelfStyle(t)||this.parent.getParentSelfStyle(t):null}getSelfInhertStyle(t){return this.getSelfStyle(t)||this.getParentSelfStyle(t)}getBorderWidth(){return this.style.merge("borderWidth",!1)||0}getData(t){return t?this.nodeData.data[t]:this.nodeData.data}getPureData(t=!0,e=!1){return Object(o["n"])({},this,t,e)}getAncestorNodes(){const t=[];let e=this.parent;while(e)t.unshift(e),e=e.parent;return t}hasCustomStyle(){return this.style.hasCustomStyle()}getRect(){return this.group?this.group.rbox():null}getRectInSvg(){const{scaleX:t,scaleY:e,translateX:i,translateY:n}=this.mindMap.draw.transform();let{left:s,top:a,width:o,height:d}=this;const h=(s+o)*t+i,r=(a+d)*e+n;return s=s*t+i,a=a*e+n,{left:s,right:h,top:a,bottom:r,width:o*t,height:d*e}}highlight(){this.group&&this.group.addClass("smm-node-highlight")}closeHighlight(){this.group&&this.group.removeClass("smm-node-highlight")}fakeClone(){const t=new zt({...this.opt,uid:Object(o["r"])()});return Object.keys(this).forEach(e=>{t[e]=this[e]}),t}createSvgTextNode(t=""){return(new a["j"]).text(t)}getSvgObjects(){return{SVG:a["i"],G:a["d"],Rect:a["h"]}}checkEnableDragModifyNodeWidth(){const{enableDragModifyNodeWidth:t,isUseCustomNodeContent:e,customCreateNodeContent:i}=this.mindMap.opt;return t&&(this.mindMap.richText||e&&i)}hasCustomWidth(){return this.checkEnableDragModifyNodeWidth()&&void 0!==this.customTextWidth}getChildrenLength(){return this.nodeData.children?this.nodeData.children.length:0}}var Bt=e["a"]=zt},a751:function(t,e,i){"use strict";i.d(e,"b",(function(){return a}));var n=i("d17d");const s=["backgroundColor","backgroundImage","backgroundRepeat","backgroundPosition","backgroundSize"],a=["gradientStyle","startColor","endColor","startDir","endDir","fillColor","borderColor","borderWidth","borderDasharray"];class o{static setBackgroundStyle(t,e){if(!t)return;if(!o.cacheStyle){o.cacheStyle={};let e=window.getComputedStyle(t);s.forEach(t=>{o.cacheStyle[t]=e[t]})}let{backgroundColor:i,backgroundImage:n,backgroundRepeat:a,backgroundPosition:d,backgroundSize:h}=e;t.style.backgroundColor=i,n&&"none"!==n?(t.style.backgroundImage=`url(${n})`,t.style.backgroundRepeat=a,t.style.backgroundPosition=d,t.style.backgroundSize=h):t.style.backgroundImage="none"}static removeBackgroundStyle(t){o.cacheStyle&&(s.forEach(e=>{t.style[e]=o.cacheStyle[e]}),o.cacheStyle=null)}constructor(t){this.ctx=t,this._markerPath=null,this._marker=null,this._gradient=null}merge(t,e){let i=this.ctx.mindMap.themeConfig,n=null,s=!1;e?(s=!0,n=i):n=this.ctx.isGeneralization?i.generalization:0===this.ctx.layerIndex?i.root:1===this.ctx.layerIndex?i.second:i.node;let a="";return a=void 0!==this.getSelfStyle(t)?this.getSelfStyle(t):void 0!==n[t]?n[t]:i[t],s||this.addToEffectiveStyles({[t]:a}),a}getStyle(t,e){return this.merge(t,e)}getSelfStyle(t){return this.ctx.getData(t)}addToEffectiveStyles(t){this.ctx.mindMap.painter&&(this.ctx.effectiveStyles={...this.ctx.effectiveStyles,...t})}rect(t){this.shape(t),t.radius(this.merge("borderRadius"))}shape(t){const e={};a.forEach(t=>{e[t]=this.merge(t)}),e.gradientStyle?(this._gradient||(this._gradient=this.ctx.nodeDraw.gradient("linear")),this._gradient.update(t=>{t.stop(0,e.startColor),t.stop(1,e.endColor)}),this._gradient.from(...e.startDir).to(...e.endDir),t.fill(this._gradient)):t.fill({color:e.fillColor}),t.stroke({color:e.borderColor,width:e.borderWidth,dasharray:e.borderDasharray})}text(t){const e={color:this.merge("color"),fontFamily:this.merge("fontFamily"),fontSize:this.merge("fontSize"),fontWeight:this.merge("fontWeight"),fontStyle:this.merge("fontStyle"),textDecoration:this.merge("textDecoration")};t.fill({color:e.color}).css({"font-family":e.fontFamily,"font-size":e.fontSize+"px","font-weight":e.fontWeight,"font-style":e.fontStyle,"text-decoration":e.textDecoration})}domText(t,e=1){const i={color:this.merge("color"),fontFamily:this.merge("fontFamily"),fontSize:this.merge("fontSize"),fontWeight:this.merge("fontWeight"),fontStyle:this.merge("fontStyle"),textDecoration:this.merge("textDecoration"),textAlign:this.merge("textAlign")};t.style.color=i.color,t.style.textDecoration=i.textDecoration,t.style.fontFamily=i.fontFamily,t.style.fontSize=i.fontSize*e+"px",t.style.fontWeight=i.fontWeight||"normal",t.style.fontStyle=i.fontStyle,t.style.textAlign=i.textAlign}tagText(t,e){t.fill({color:"#fff"}).css({"font-size":e.fontSize+"px"})}tagRect(t,e){t.fill({color:e.fill}),e.radius&&t.radius(e.radius)}iconNode(t,e){t.attr({fill:e||this.merge("color")})}line(t,{width:e,color:i,dasharray:n}={},s,a){const{customHandleLine:o}=this.ctx.mindMap.opt;if("function"===typeof o&&o(this.ctx,t,{width:e,color:i,dasharray:n}),t.stroke({color:i,dasharray:n,width:e}).fill({color:"none"}),s){const e=this.merge("showLineMarker",!0),n=a.style;if(e){n._marker=n._marker||n.createMarker(),n._markerPath.stroke({color:i}).fill({color:i}),t.attr("marker-start",""),t.attr("marker-end","");const e=n.merge("lineMarkerDir");t.marker(e,n._marker)}else n._marker&&(t.attr("marker-start",""),t.attr("marker-end",""),n._marker.remove(),n._marker=null)}}createMarker(){return this.ctx.lineDraw.marker(20,20,t=>{t.ref(8,5),t.size(20,20),t.attr("markerUnits","userSpaceOnUse"),t.attr("orient","auto-start-reverse"),this._markerPath=t.path("M0,0 L2,5 L0,10 L10,5 Z")})}generalizationLine(t){t.stroke({width:this.merge("generalizationLineWidth",!0),color:this.merge("generalizationLineColor",!0)}).fill({color:"none"})}iconBtn(t,e,i){let{color:n,fill:s,fontSize:a,fontColor:o}=this.ctx.mindMap.opt.expandBtnStyle||{color:"#808080",fill:"#fff",fontSize:12,strokeColor:"#333333",fontColor:"#333333"};t.fill({color:n}),e.fill({color:n}),i.fill({color:s}),this.ctx.mindMap.opt.isShowExpandNum&&t.attr({"font-size":a+"px","font-color":o})}hasCustomStyle(){let t=!1;return Object.keys(this.ctx.getData()).forEach(e=>{Object(n["g"])(e)&&(t=!0)}),t}getCustomStyle(){const t={};return Object.keys(this.ctx.getData()).forEach(e=>{Object(n["g"])(e)&&(t[e]=this.ctx.getData(e))}),t}hoverNode(t){const e=this.merge("hoverRectColor")||this.ctx.mindMap.opt.hoverRectColor,i=this.merge("hoverRectRadius");t.radius(i).fill("none").stroke({color:e})}onRemove(){this._marker&&(this._marker.remove(),this._marker=null),this._markerPath&&(this._markerPath.remove(),this._markerPath=null),this._gradient&&(this._gradient.remove(),this._gradient=null)}}o.cacheStyle=null,e["a"]=o},ce3a:function(t,e,i){"use strict";var n=i("586a"),s=i.n(n),a=i("048e"),o=i("8ecc"),d=i("791b"),h=i("aea3"),r=i("eab3"),l=i("0a4c"),c=i("6b5a"),m=i("d17d"),p=i("6ac9");const g="smm-node-edit-wrap";class u{constructor(t){this.renderer=t,this.mindMap=t.mindMap,this.currentNode=null,this.textEditNode=null,this.showTextEdit=!1,this.cacheEditingText="",this.hasBodyMousedown=!1,this.textNodePaddingX=5,this.textNodePaddingY=3,this.isNeedUpdateTextEditNode=!1,this.mindMap.addEditNodeClass(g),this.bindEvent()}bindEvent(){this.show=this.show.bind(this),this.onScale=this.onScale.bind(this),this.onKeydown=this.onKeydown.bind(this),this.mindMap.on("node_dblclick",(t,e,i)=>{this.show({node:t,e:e,isInserting:i})}),this.mindMap.on("draw_click",()=>{this.hideEditTextBox()}),this.mindMap.on("body_mousedown",()=>{this.hasBodyMousedown=!0}),this.mindMap.on("body_click",()=>{this.hasBodyMousedown&&(this.hasBodyMousedown=!1,this.mindMap.opt.isEndNodeTextEditOnClickOuter&&this.hideEditTextBox())}),this.mindMap.on("svg_mousedown",()=>{this.hideEditTextBox()}),this.mindMap.on("expand_btn_click",()=>{this.hideEditTextBox()}),this.mindMap.on("before_node_active",()=>{this.hideEditTextBox()}),this.mindMap.on("mousewheel",()=>{this.mindMap.opt.mousewheelAction===p["a"].MOUSE_WHEEL_ACTION.MOVE&&this.hideEditTextBox()}),this.mindMap.keyCommand.addShortcut("F2",()=>{this.renderer.activeNodeList.length<=0||this.show({node:this.renderer.activeNodeList[0]})}),this.mindMap.on("scale",this.onScale),this.mindMap.opt.enableAutoEnterTextEditWhenKeydown&&window.addEventListener("keydown",this.onKeydown),this.mindMap.on("beforeDestroy",()=>{this.unBindEvent()}),this.mindMap.on("after_update_config",(t,e)=>{t.openRealtimeRenderOnNodeTextEdit!==e.openRealtimeRenderOnNodeTextEdit&&(this.mindMap.richText?this.mindMap.richText.onOpenRealtimeRenderOnNodeTextEditConfigUpdate(t.openRealtimeRenderOnNodeTextEdit):this.onOpenRealtimeRenderOnNodeTextEditConfigUpdate(t.openRealtimeRenderOnNodeTextEdit)),t.enableAutoEnterTextEditWhenKeydown!==e.enableAutoEnterTextEditWhenKeydown&&window[t.enableAutoEnterTextEditWhenKeydown?"addEventListener":"removeEventListener"]("keydown",this.onKeydown)}),this.mindMap.on("afterExecCommand",()=>{this.isShowTextEdit()&&(this.isNeedUpdateTextEditNode=!0)}),this.mindMap.on("node_tree_render_end",()=>{this.isShowTextEdit()&&this.isNeedUpdateTextEditNode&&(this.isNeedUpdateTextEditNode=!1,this.updateTextEditNode())})}unBindEvent(){window.removeEventListener("keydown",this.onKeydown)}onKeydown(t){if(t.target!==document.body)return;const e=this.mindMap.renderer.activeNodeList;if(e.length<=0||e.length>1)return;const i=e[0];i&&this.checkIsAutoEnterTextEditKey(t)&&(t.preventDefault(),this.show({node:i,e:t,isInserting:!1,isFromKeyDown:!0}))}checkIsAutoEnterTextEditKey(t){const e=t.keyCode;return(229===e||e>=65&&e<=90||e>=48&&e<=57)&&!this.mindMap.keyCommand.hasCombinationKey(t)}registerTmpShortcut(){this.mindMap.keyCommand.addShortcut("Enter",()=>{this.hideEditTextBox()}),this.mindMap.keyCommand.addShortcut("Tab",()=>{this.hideEditTextBox()})}isShowTextEdit(){return this.mindMap.richText?this.mindMap.richText.showTextEdit:this.showTextEdit}setIsShowTextEdit(t){this.showTextEdit=t,t?this.mindMap.keyCommand.stopCheckInSvg():this.mindMap.keyCommand.recoveryCheckInSvg()}async show({node:t,isInserting:e=!1,isFromKeyDown:i=!1,isFromScale:n=!1}){if(t.isUseCustomNodeContent())return;const s=this.getCurrentEditNode();s&&this.hideEditTextBox();const{beforeTextEdit:a,openRealtimeRenderOnNodeTextEdit:o}=this.mindMap.opt;if("function"===typeof a){let i=!1;try{i=await a(t,e)}catch(g){i=!1,this.mindMap.opt.errorHandler(p["b"].BEFORE_TEXT_EDIT_ERROR,g)}if(!i)return}const{offsetLeft:d,offsetTop:h}=Object(m["j"])(this.mindMap,t);this.mindMap.view.translateXY(d,h);const r=t._textData.node;o&&r.show();const l=r.node.getBoundingClientRect();o&&r.hide();const c={node:t,rect:l,isInserting:e,isFromKeyDown:i,isFromScale:n};this.mindMap.richText?this.mindMap.richText.showEditText(c):(this.currentNode=t,this.showEditTextBox(c))}onOpenRealtimeRenderOnNodeTextEditConfigUpdate(t){this.textEditNode&&(this.textEditNode.style.background=t?"transparent":this.currentNode?this.getBackground(this.currentNode):"",this.textEditNode.style.boxShadow=t?"none":"0 0 20px rgba(0,0,0,.5)")}onScale(){const t=this.getCurrentEditNode();t&&(this.mindMap.richText?(this.mindMap.richText.cacheEditingText=this.mindMap.richText.getEditText(),this.mindMap.richText.showTextEdit=!1):(this.cacheEditingText=this.getEditText(),this.setIsShowTextEdit(!1)),this.show({node:t,isFromScale:!0}))}showEditTextBox({node:t,rect:e,isInserting:i,isFromKeyDown:n,isFromScale:s}){if(this.showTextEdit)return;const{nodeTextEditZIndex:a,textAutoWrapWidth:o,selectTextOnEnterEditText:d,openRealtimeRenderOnNodeTextEdit:h,autoEmptyTextWhenKeydownEnterEdit:r}=this.mindMap.opt;if(s||this.mindMap.emit("before_show_text_edit"),this.registerTmpShortcut(),!this.textEditNode){this.textEditNode=document.createElement("div"),this.textEditNode.classList.add(g),this.textEditNode.style.cssText=`\n        position: fixed;\n        box-sizing: border-box;\n        ${h?"":"box-shadow: 0 0 20px rgba(0,0,0,.5);"}\n        padding: ${this.textNodePaddingY}px ${this.textNodePaddingX}px;\n        margin-left: -${this.textNodePaddingX}px;\n        margin-top: -${this.textNodePaddingY}px;\n        outline: none; \n        word-break: break-all;\n        line-break: anywhere;\n      `,this.textEditNode.setAttribute("contenteditable",!0),this.textEditNode.addEventListener("keyup",t=>{t.stopPropagation()}),this.textEditNode.addEventListener("click",t=>{t.stopPropagation()}),this.textEditNode.addEventListener("mousedown",t=>{t.stopPropagation()}),this.textEditNode.addEventListener("keydown",t=>{this.checkIsAutoEnterTextEditKey(t)&&t.stopPropagation()}),this.textEditNode.addEventListener("paste",t=>{const e=t.clipboardData.getData("text"),{isSmm:i,data:n}=Object(m["k"])(e);i&&n[0]&&n[0].data?Object(m["T"])(t,Object(m["O"])(n[0].data.text)):Object(m["T"])(t),this.emitTextChangeEvent()}),this.textEditNode.addEventListener("input",()=>{this.emitTextChangeEvent()});const t=this.mindMap.opt.customInnerElsAppendTo||document.body;t.appendChild(this.textEditNode)}const l=this.mindMap.view.scale,c=t.style.merge("fontSize"),u=(this.cacheEditingText||t.getData("text")).split(/\n/gim).map(t=>Object(m["V"])(t)),x="true"===t._textData.node.attr("data-ismultiLine");t.style.domText(this.textEditNode,l),h||(this.textEditNode.style.background=this.getBackground(t)),this.textEditNode.style.zIndex=a,this.textEditNode.innerHTML=n&&r?"":u.join("<br>"),this.textEditNode.style.minWidth=e.width+2*this.textNodePaddingX+"px",this.textEditNode.style.minHeight=e.height+"px",this.textEditNode.style.left=Math.floor(e.left)+"px",this.textEditNode.style.top=Math.floor(e.top)+"px",this.textEditNode.style.display="block",this.textEditNode.style.maxWidth=o*l+"px",x?(this.textEditNode.style.lineHeight=p["g"],this.textEditNode.style.transform=`translateY(${(p["g"]-1)*c/2*l}px)`):this.textEditNode.style.lineHeight="normal",this.setIsShowTextEdit(!0),i||d&&!n?Object(m["rb"])(this.textEditNode):Object(m["x"])(this.textEditNode),this.cacheEditingText=""}emitTextChangeEvent(){this.mindMap.emit("node_text_edit_change",{node:this.currentNode,text:this.getEditText(),richText:!1})}updateTextEditNode(){if(this.mindMap.richText)return void this.mindMap.richText.updateTextEditNode();if(!this.showTextEdit||!this.currentNode)return;const t=this.currentNode._textData.node.node.getBoundingClientRect();this.textEditNode.style.minWidth=t.width+2*this.textNodePaddingX+"px",this.textEditNode.style.minHeight=t.height+2*this.textNodePaddingY+"px",this.textEditNode.style.left=Math.floor(t.left)+"px",this.textEditNode.style.top=Math.floor(t.top)+"px"}getBackground(t){const e=t.style.merge("gradientStyle");if(e){const e=t.style.merge("startColor"),i=t.style.merge("endColor");return`linear-gradient(to right, ${e}, ${i})`}{const e=t.style.merge("fillColor"),i=t.style.merge("color");return"transparent"===e?Object(m["cb"])(i)?Object(m["R"])(this.mindMap.themeConfig):"#fff":e}}removeTextEditEl(){if(this.mindMap.richText)return void this.mindMap.richText.removeTextEditEl();if(!this.textEditNode)return;const t=this.mindMap.opt.customInnerElsAppendTo||document.body;t.removeChild(this.textEditNode)}getEditText(){return Object(m["N"])(this.textEditNode.innerHTML)}hideEditTextBox(){if(this.mindMap.richText)return this.mindMap.richText.hideEditText();if(!this.showTextEdit)return;const t=this.currentNode,e=this.getEditText();this.currentNode=null,this.textEditNode.style.display="none",this.textEditNode.innerHTML="",this.textEditNode.style.fontFamily="inherit",this.textEditNode.style.fontSize="inherit",this.textEditNode.style.fontWeight="normal",this.textEditNode.style.transform="translateY(0)",this.setIsShowTextEdit(!1),this.mindMap.execCommand("SET_NODE_TEXT",t,e),this.mindMap.render(),this.mindMap.emit("hide_text_edit",this.textEditNode,this.renderer.activeNodeList,t)}getCurrentEditNode(){return this.mindMap.richText?this.mindMap.richText.node:this.currentNode}}var x=i("0f9a"),N=i("989e"),E=i("6682");const f={[p["a"].LAYOUT.LOGICAL_STRUCTURE]:a["a"],[p["a"].LAYOUT.LOGICAL_STRUCTURE_LEFT]:a["a"],[p["a"].LAYOUT.MIND_MAP]:o["a"],[p["a"].LAYOUT.CATALOG_ORGANIZATION]:d["a"],[p["a"].LAYOUT.ORGANIZATION_STRUCTURE]:h["a"],[p["a"].LAYOUT.TIMELINE]:r["a"],[p["a"].LAYOUT.TIMELINE2]:r["a"],[p["a"].LAYOUT.VERTICAL_TIMELINE]:l["a"],[p["a"].LAYOUT.VERTICAL_TIMELINE2]:l["a"],[p["a"].LAYOUT.VERTICAL_TIMELINE3]:l["a"],[p["a"].LAYOUT.FISHBONE]:c["a"],[p["a"].LAYOUT.FISHBONE2]:c["a"]};class _{constructor(t={}){this.opt=t,this.mindMap=t.mindMap,this.themeConfig=this.mindMap.themeConfig,this.renderTree=this.mindMap.opt.data?s()({},this.mindMap.opt.data):null,this.reRender=!1,this.isRendering=!1,this.hasWaitRendering=!1,this.nodeCache={},this.lastNodeCache={},this.renderSourceList=[],this.renderCallbackList=[],this.activeNodeList=[],this.emitNodeActiveEventTimer=null,this.renderTimer=null,this.root=null,this.textEdit=new u(this),this.beingCopyData=null,this.highlightBoxNode=null,this.highlightBoxNodeStyle=null,this.lastActiveNodeList=[],this.setLayout(),this.bindEvent(),this.registerCommands(),this.registerShortcutKeys()}setLayout(){this.layout&&this.layout.beforeChange&&this.layout.beforeChange();const{layout:t}=this.mindMap.opt;let e=f[t]||this.mindMap[t];e||(e=f[p["a"].LAYOUT.LOGICAL_STRUCTURE],this.mindMap.opt.layout=p["a"].LAYOUT.LOGICAL_STRUCTURE),this.layout=new e(this,t)}setData(t){this.renderTree=t||null}bindEvent(){const{openPerformance:t,performanceConfig:e,openRealtimeRenderOnNodeTextEdit:i}=this.mindMap.opt;this.mindMap.on("draw_click",t=>{this.clearActiveNodeListOnDrawClick(t,"click")}),this.mindMap.on("contextmenu",t=>{this.clearActiveNodeListOnDrawClick(t,"contextmenu")}),this.mindMap.svg.on("dblclick",()=>{this.mindMap.opt.enableDblclickBackToRootNode&&this.setRootNodeCenter()});const n=Object(m["wb"])(()=>{this.renderTree&&this.root&&(this.mindMap.emit("node_tree_render_start"),this.root.render(()=>{this.mindMap.emit("node_tree_render_end")},!1,!0))},e.time);t&&this.mindMap.on("view_data_change",n),this.onNodeTextEditChange=Object(m["t"])(this.onNodeTextEditChange,100,this),i&&this.mindMap.on("node_text_edit_change",this.onNodeTextEditChange),this.mindMap.on("after_update_config",(t,e)=>{t.openPerformance!==e.openPerformance&&(this.mindMap[t.openPerformance?"on":"off"]("view_data_change",n),this.forceLoadNode()),t.openRealtimeRenderOnNodeTextEdit!==e.openRealtimeRenderOnNodeTextEdit&&this.mindMap[t.openRealtimeRenderOnNodeTextEdit?"on":"off"]("node_text_edit_change",this.onNodeTextEditChange)})}onNodeTextEditChange({node:t,text:e}){t._textData=t.createTextNode(e);const{width:i,height:n}=t.getNodeRect();t.width=i,t.height=n,t.layout(),this.mindMap.render(()=>{this.textEdit.updateTextEditNode()})}forceLoadNode(t){t=t||this.root,t&&(this.mindMap.emit("node_tree_render_start"),t.render(()=>{this.mindMap.emit("node_tree_render_end")},!0))}registerCommands(){this.selectAll=this.selectAll.bind(this),this.mindMap.command.add("SELECT_ALL",this.selectAll),this.back=this.back.bind(this),this.mindMap.command.add("BACK",this.back),this.forward=this.forward.bind(this),this.mindMap.command.add("FORWARD",this.forward),this.insertNode=this.insertNode.bind(this),this.mindMap.command.add("INSERT_NODE",this.insertNode),this.insertMultiNode=this.insertMultiNode.bind(this),this.mindMap.command.add("INSERT_MULTI_NODE",this.insertMultiNode),this.insertChildNode=this.insertChildNode.bind(this),this.mindMap.command.add("INSERT_CHILD_NODE",this.insertChildNode),this.insertMultiChildNode=this.insertMultiChildNode.bind(this),this.mindMap.command.add("INSERT_MULTI_CHILD_NODE",this.insertMultiChildNode),this.insertParentNode=this.insertParentNode.bind(this),this.mindMap.command.add("INSERT_PARENT_NODE",this.insertParentNode),this.upNode=this.upNode.bind(this),this.mindMap.command.add("UP_NODE",this.upNode),this.downNode=this.downNode.bind(this),this.mindMap.command.add("DOWN_NODE",this.downNode),this.moveUpOneLevel=this.moveUpOneLevel.bind(this),this.mindMap.command.add("MOVE_UP_ONE_LEVEL",this.moveUpOneLevel),this.insertAfter=this.insertAfter.bind(this),this.mindMap.command.add("INSERT_AFTER",this.insertAfter),this.insertBefore=this.insertBefore.bind(this),this.mindMap.command.add("INSERT_BEFORE",this.insertBefore),this.moveNodeTo=this.moveNodeTo.bind(this),this.mindMap.command.add("MOVE_NODE_TO",this.moveNodeTo),this.removeNode=this.removeNode.bind(this),this.mindMap.command.add("REMOVE_NODE",this.removeNode),this.removeCurrentNode=this.removeCurrentNode.bind(this),this.mindMap.command.add("REMOVE_CURRENT_NODE",this.removeCurrentNode),this.pasteNode=this.pasteNode.bind(this),this.mindMap.command.add("PASTE_NODE",this.pasteNode),this.cutNode=this.cutNode.bind(this),this.mindMap.command.add("CUT_NODE",this.cutNode),this.setNodeStyle=this.setNodeStyle.bind(this),this.mindMap.command.add("SET_NODE_STYLE",this.setNodeStyle),this.setNodeStyles=this.setNodeStyles.bind(this),this.mindMap.command.add("SET_NODE_STYLES",this.setNodeStyles),this.setNodeActive=this.setNodeActive.bind(this),this.mindMap.command.add("SET_NODE_ACTIVE",this.setNodeActive),this.clearActiveNode=this.clearActiveNode.bind(this),this.mindMap.command.add("CLEAR_ACTIVE_NODE",this.clearActiveNode),this.setNodeExpand=this.setNodeExpand.bind(this),this.mindMap.command.add("SET_NODE_EXPAND",this.setNodeExpand),this.expandAllNode=this.expandAllNode.bind(this),this.mindMap.command.add("EXPAND_ALL",this.expandAllNode),this.unexpandAllNode=this.unexpandAllNode.bind(this),this.mindMap.command.add("UNEXPAND_ALL",this.unexpandAllNode),this.expandToLevel=this.expandToLevel.bind(this),this.mindMap.command.add("UNEXPAND_TO_LEVEL",this.expandToLevel),this.setNodeData=this.setNodeData.bind(this),this.mindMap.command.add("SET_NODE_DATA",this.setNodeData),this.setNodeText=this.setNodeText.bind(this),this.mindMap.command.add("SET_NODE_TEXT",this.setNodeText),this.setNodeImage=this.setNodeImage.bind(this),this.mindMap.command.add("SET_NODE_IMAGE",this.setNodeImage),this.setNodeIcon=this.setNodeIcon.bind(this),this.mindMap.command.add("SET_NODE_ICON",this.setNodeIcon),this.setNodeHyperlink=this.setNodeHyperlink.bind(this),this.mindMap.command.add("SET_NODE_HYPERLINK",this.setNodeHyperlink),this.setNodeNote=this.setNodeNote.bind(this),this.mindMap.command.add("SET_NODE_NOTE",this.setNodeNote),this.setNodeAttachment=this.setNodeAttachment.bind(this),this.mindMap.command.add("SET_NODE_ATTACHMENT",this.setNodeAttachment),this.setNodeTag=this.setNodeTag.bind(this),this.mindMap.command.add("SET_NODE_TAG",this.setNodeTag),this.insertFormula=this.insertFormula.bind(this),this.mindMap.command.add("INSERT_FORMULA",this.insertFormula),this.addGeneralization=this.addGeneralization.bind(this),this.mindMap.command.add("ADD_GENERALIZATION",this.addGeneralization),this.removeGeneralization=this.removeGeneralization.bind(this),this.mindMap.command.add("REMOVE_GENERALIZATION",this.removeGeneralization),this.setNodeCustomPosition=this.setNodeCustomPosition.bind(this),this.mindMap.command.add("SET_NODE_CUSTOM_POSITION",this.setNodeCustomPosition),this.resetLayout=this.resetLayout.bind(this),this.mindMap.command.add("RESET_LAYOUT",this.resetLayout),this.setNodeShape=this.setNodeShape.bind(this),this.mindMap.command.add("SET_NODE_SHAPE",this.setNodeShape),this.goTargetNode=this.goTargetNode.bind(this),this.mindMap.command.add("GO_TARGET_NODE",this.goTargetNode),this.removeCustomStyles=this.removeCustomStyles.bind(this),this.mindMap.command.add("REMOVE_CUSTOM_STYLES",this.removeCustomStyles),this.removeAllNodeCustomStyles=this.removeAllNodeCustomStyles.bind(this),this.mindMap.command.add("REMOVE_ALL_NODE_CUSTOM_STYLES",this.removeAllNodeCustomStyles)}registerShortcutKeys(){this.mindMap.keyCommand.addShortcut("Tab",()=>{this.mindMap.execCommand("INSERT_CHILD_NODE")}),this.mindMap.keyCommand.addShortcut("Insert",()=>{this.mindMap.execCommand("INSERT_CHILD_NODE")}),this.mindMap.keyCommand.addShortcut("Enter",()=>{this.mindMap.execCommand("INSERT_NODE")}),this.mindMap.keyCommand.addShortcut("Shift+Tab",()=>{this.mindMap.execCommand("INSERT_PARENT_NODE")}),this.mindMap.keyCommand.addShortcut("Control+g",()=>{this.mindMap.execCommand("ADD_GENERALIZATION")}),this.toggleActiveExpand=this.toggleActiveExpand.bind(this),this.mindMap.keyCommand.addShortcut("/",this.toggleActiveExpand),this.mindMap.keyCommand.addShortcut("Del|Backspace",()=>{this.mindMap.execCommand("REMOVE_NODE")}),this.mindMap.keyCommand.addShortcut("Shift+Backspace",()=>{this.mindMap.execCommand("REMOVE_CURRENT_NODE")}),this.mindMap.on("before_show_text_edit",()=>{this.startTextEdit()}),this.mindMap.on("hide_text_edit",()=>{this.endTextEdit()}),this.mindMap.keyCommand.addShortcut("Control+a",()=>{this.mindMap.execCommand("SELECT_ALL")}),this.mindMap.keyCommand.addShortcut("Control+l",()=>{this.mindMap.execCommand("RESET_LAYOUT")}),this.mindMap.keyCommand.addShortcut("Control+Up",()=>{this.mindMap.execCommand("UP_NODE")}),this.mindMap.keyCommand.addShortcut("Control+Down",()=>{this.mindMap.execCommand("DOWN_NODE")}),this.mindMap.keyCommand.addShortcut("Control+c",()=>{this.copy()}),this.mindMap.keyCommand.addShortcut("Control+x",()=>{this.cut()}),this.mindMap.keyCommand.addShortcut("Control+v",()=>{this.paste()}),this.mindMap.keyCommand.addShortcut("Control+Enter",()=>{this.setRootNodeCenter()})}emitNodeActiveEvent(t=null,e=[...this.activeNodeList]){const i=!Object(m["i"])(this.lastActiveNodeList,e);i&&(this.lastActiveNodeList=[...e],clearTimeout(this.emitNodeActiveEventTimer),this.emitNodeActiveEventTimer=setTimeout(()=>{this.mindMap.emit("node_active",t,e)},0))}clearActiveNodeListOnDrawClick(t,e){if(this.activeNodeList.length<=0)return;let i=!0;const{useLeftKeySelectionRightKeyDrag:n}=this.mindMap.opt;if("contextmenu"===e?!n:n){const e=this.mindMap.event.mousedownPos;i=Math.abs(t.clientX-e.x)<=5&&Math.abs(t.clientY-e.y)<=5}i&&this.mindMap.execCommand("CLEAR_ACTIVE_NODE")}startTextEdit(){this.mindMap.keyCommand.save()}endTextEdit(){this.mindMap.keyCommand.restore()}clearCache(){this.layout.lru.clear(),this.nodeCache={},this.lastNodeCache={}}addRenderParams(t,e){if(t){const e=this.renderCallbackList.findIndex(e=>e===t);-1===e&&this.renderCallbackList.push(t)}if(e){const t=this.renderSourceList.findIndex(t=>t===e);-1===t&&this.renderSourceList.push(e)}}checkHasRenderSource(t){t=Array.isArray(t)?t:[t];for(let e=0;e<this.renderSourceList.length;e++)if(t.includes(this.renderSourceList[e]))return!0;return!1}onRenderEnd(){this.renderCallbackList.forEach(t=>{t()}),this.isRendering=!1,this.reRender=!1,this.renderCallbackList=[],this.renderSourceList=[],this.mindMap.emit("node_tree_render_end")}render(t,e){this.addRenderParams(t,e),clearTimeout(this.renderTimer),this.renderTimer=setTimeout(()=>{this._render()},0)}_render(){this.checkHasRenderSource(p["a"].CHANGE_THEME)&&this.resetUnExpandNodeStyle(),this.isRendering?this.hasWaitRendering=!0:(this.isRendering=!0,this.lastNodeCache=this.nodeCache,this.nodeCache={},this.reRender&&this.clearActiveNodeList(),this.renderTree?(this.mindMap.emit("node_tree_render_start"),this.root=null,this.layout.doLayout(t=>{Object.keys(this.lastNodeCache).forEach(t=>{this.nodeCache[t]||(this.removeNodeFromActiveList(this.lastNodeCache[t]),this.emitNodeActiveEvent(),this.lastNodeCache[t].destroy())}),this.root=t,this.root.render(()=>{if(this.isRendering=!1,this.hasWaitRendering)return this.hasWaitRendering=!1,void this.render();this.onRenderEnd()})}),this.emitNodeActiveEvent()):this.onRenderEnd())}resetUnExpandNodeStyle(){this.renderTree&&Object(m["yb"])(this.renderTree,null,t=>{if(!t.data.expand)return Object(m["yb"])(t,null,t=>{t.data["needUpdate"]=!0}),!0})}clearActiveNode(){this.activeNodeList.length<=0||(this.clearActiveNodeList(),this.emitNodeActiveEvent(null,[]))}clearActiveNodeList(){this.activeNodeList.forEach(t=>{this.mindMap.execCommand("SET_NODE_ACTIVE",t,!1)}),this.activeNodeList=[]}addNodeToActiveList(t,e=!1){if(this.mindMap.opt.onlyOneEnableActiveNodeOnCooperate&&t.userList.length>0)return;const i=this.findActiveNodeIndex(t);-1===i&&(e||this.mindMap.emit("before_node_active",t,this.activeNodeList),this.mindMap.execCommand("SET_NODE_ACTIVE",t,!0),this.activeNodeList.push(t))}removeNodeFromActiveList(t){let e=this.findActiveNodeIndex(t);-1!==e&&(this.mindMap.execCommand("SET_NODE_ACTIVE",t,!1),this.activeNodeList.splice(e,1))}activeMultiNode(t=[]){t.forEach(t=>{this.mindMap.emit("before_node_active",t,this.activeNodeList),this.addNodeToActiveList(t,!0),this.emitNodeActiveEvent(t)})}cancelActiveMultiNode(t=[]){t.forEach(t=>{this.removeNodeFromActiveList(t),this.emitNodeActiveEvent(null)})}findActiveNodeIndex(t){return Object(m["H"])(t,this.activeNodeList)}selectAll(){this.mindMap.opt.readonly||(Object(m["yb"])(this.root,null,t=>{t.getData("isActive")||this.addNodeToActiveList(t),t._generalizationList&&t._generalizationList.length>0&&t._generalizationList.forEach(t=>{const e=t.generalizationNode;e.getData("isActive")||this.addNodeToActiveList(e)})},null,!0,0,0),this.emitNodeActiveEvent())}back(t){this.backForward("back",t)}forward(t){this.backForward("forward",t)}backForward(t,e){this.mindMap.execCommand("CLEAR_ACTIVE_NODE");const i=this.mindMap.command[t](e);i&&(this.renderTree=i,this.mindMap.render()),this.mindMap.emit("data_change",i)}getNewNodeBehavior(t=!1,e=!1){const{createNewNodeBehavior:i}=this.mindMap.opt;let n=!1,s=!1;switch(i){case p["a"].CREATE_NEW_NODE_BEHAVIOR.DEFAULT:n=e||!t,s=!e&&t;break;case p["a"].CREATE_NEW_NODE_BEHAVIOR.NOT_ACTIVE:n=!1,s=!1;break;case p["a"].CREATE_NEW_NODE_BEHAVIOR.ACTIVE_ONLY:n=!0,s=!1;break;default:break}return{focusNewNode:n,inserting:s}}insertNode(t=!0,e=[],i=null,n=[]){if(e=Object(m["y"])(e),this.activeNodeList.length<=0&&e.length<=0)return;this.textEdit.hideEditTextBox();const{defaultInsertSecondLevelNodeText:s,defaultInsertBelowSecondLevelNodeText:a}=this.mindMap.opt,o=e.length>0?e:this.activeNodeList,d=o.length>1,h=this.hasRichTextPlugin(),{focusNewNode:r,inserting:l}=this.getNewNodeBehavior(t,d),c={expand:!0,richText:h,isActive:r};h&&(c.resetRichText=!0),n=Object(m["a"])(n,c);const p=i&&i.richText;let g=!1;o.forEach(t=>{if(t.isGeneralization||t.isRoot)return;n=Object(m["tb"])(n);const e=t.parent,o=1===t.layerIndex,d=o?s:a,h=Object(m["G"])(t);p&&c.resetRichText&&delete c.resetRichText;const r={inserting:l,data:{text:d,...c,uid:Object(m["r"])(),...i||{}},children:[...Object(m["s"])(n,g)]};g=!0,e.nodeData.children.splice(h+1,0,r)}),r&&this.clearActiveNodeList(),this.mindMap.render()}insertMultiNode(t,e){if(!e||e.length<=0)return;if(t=Object(m["y"])(t),this.activeNodeList.length<=0&&t.length<=0)return;this.textEdit.hideEditTextBox();const i=t.length>0?t:this.activeNodeList,n=this.hasRichTextPlugin(),{focusNewNode:s}=this.getNewNodeBehavior(!1,!0),a={expand:!0,richText:n,isActive:s};n&&(a.resetRichText=!0),e=Object(m["a"])(e,a);let o=!1;i.forEach(t=>{if(t.isGeneralization||t.isRoot)return;e=Object(m["tb"])(e);const i=t.parent,n=Object(m["G"])(t),s=Object(m["s"])(e,o);o=!0,i.nodeData.children.splice(n+1,0,...s)}),s&&this.clearActiveNodeList(),this.mindMap.render()}insertChildNode(t=!0,e=[],i=null,n=[]){if(e=Object(m["y"])(e),this.activeNodeList.length<=0&&e.length<=0)return;this.textEdit.hideEditTextBox();const{defaultInsertSecondLevelNodeText:s,defaultInsertBelowSecondLevelNodeText:a}=this.mindMap.opt,o=e.length>0?e:this.activeNodeList,d=o.length>1,h=this.hasRichTextPlugin(),{focusNewNode:r,inserting:l}=this.getNewNodeBehavior(t,d),c={expand:!0,richText:h,isActive:r};h&&(c.resetRichText=!0),n=Object(m["a"])(n,c);const p=i&&i.richText;let g=!1;o.forEach(t=>{if(t.isGeneralization)return;n=Object(m["tb"])(n),t.nodeData.children||(t.nodeData.children=[]);const e=t.isRoot?s:a;p&&c.resetRichText&&delete c.resetRichText;const o={inserting:l,data:{text:e,uid:Object(m["r"])(),...c,...i||{}},children:[...Object(m["s"])(n,g)]};g=!0,t.nodeData.children.push(o),t.setData({expand:!0})}),r&&this.clearActiveNodeList(),this.mindMap.render()}insertMultiChildNode(t,e){if(!e||e.length<=0)return;if(t=Object(m["y"])(t),this.activeNodeList.length<=0&&t.length<=0)return;this.textEdit.hideEditTextBox();const i=t.length>0?t:this.activeNodeList,n=this.hasRichTextPlugin(),{focusNewNode:s}=this.getNewNodeBehavior(!1,!0),a={expand:!0,richText:n,isActive:s};n&&(a.resetRichText=!0),e=Object(m["a"])(e,a);let o=!1;i.forEach(t=>{t.isGeneralization||(e=Object(m["tb"])(e),t.nodeData.children||(t.nodeData.children=[]),e=Object(m["s"])(e,o),o=!0,t.nodeData.children.push(...e),t.setData({expand:!0}))}),s&&this.clearActiveNodeList(),this.mindMap.render()}insertParentNode(t=!0,e,i){if(e=Object(m["y"])(e),this.activeNodeList.length<=0&&e.length<=0)return;this.textEdit.hideEditTextBox();const{defaultInsertSecondLevelNodeText:n,defaultInsertBelowSecondLevelNodeText:s}=this.mindMap.opt,a=e.length>0?e:this.activeNodeList,o=a.length>1,d=this.hasRichTextPlugin(),{focusNewNode:h,inserting:r}=this.getNewNodeBehavior(t,o),l={expand:!0,richText:d,isActive:h};d&&(l.resetRichText=!0);const c=i&&i.richText;a.forEach(t=>{if(t.isGeneralization||t.isRoot)return;const e=1===t.layerIndex?n:s;c&&l.resetRichText&&delete l.resetRichText;const a={inserting:r,data:{text:e,uid:Object(m["r"])(),...l,...i||{}},children:[t.nodeData]},o=t.parent,d=Object(m["G"])(t);o.nodeData.children.splice(d,1,a)}),h&&this.clearActiveNodeList(),this.mindMap.render()}upNode(t){if(this.activeNodeList.length<=0&&!t)return;const e=t?[t]:this.activeNodeList,i=e[0];if(i.isRoot)return;let n=i.parent,s=n.children,a=Object(m["H"])(i,s);if(-1===a||0===a)return;let o=a-1;s.splice(a,1),s.splice(o,0,i),n.nodeData.children.splice(a,1),n.nodeData.children.splice(o,0,i.nodeData),this.mindMap.render()}downNode(t){if(this.activeNodeList.length<=0&&!t)return;const e=t?[t]:this.activeNodeList,i=e[0];if(i.isRoot)return;let n=i.parent,s=n.children,a=Object(m["H"])(i,s);if(-1===a||a===s.length-1)return;let o=a+1;s.splice(a,1),s.splice(o,0,i),n.nodeData.children.splice(a,1),n.nodeData.children.splice(o,0,i.nodeData),this.mindMap.render()}moveUpOneLevel(t){if(t=t||this.activeNodeList[0],!t||t.isRoot||t.layerIndex<=1)return;const e=t.parent,i=e.parent,n=Object(m["H"])(t,e.children),s=Object(m["H"])(e,i.children);e.nodeData.children.splice(n,1),i.nodeData.children.splice(s+1,0,t.nodeData),this.mindMap.render()}_handleRemoveCustomStyles(t){let e=!1;return Object.keys(t).forEach(i=>{Object(m["g"])(i)&&(e=!0,delete t[i])}),this.hasRichTextPlugin()&&(e=!0,t.resetRichText=!0),e}removeCustomStyles(t){if(t=t||this.activeNodeList[0],!t)return;const e=this._handleRemoveCustomStyles(t.getData());e&&this.reRenderNodeCheckChange(t)}removeAllNodeCustomStyles(t){t=Object(m["y"])(t);let e=!1;if(t.length>0)t.forEach(t=>{const i=this._handleRemoveCustomStyles(t.getData());i&&(e=!0)});else{if(!this.renderTree)return;Object(m["yb"])(this.renderTree,null,t=>{const i=this._handleRemoveCustomStyles(t.data);i&&(e=!0);const n=Object(m["z"])(t.data);n.length>0&&n.forEach(t=>{const i=this._handleRemoveCustomStyles(t);i&&(e=!0)})})}e&&this.mindMap.reRender()}copy(){this.beingCopyData=this.copyNode(),this.beingCopyData&&(this.mindMap.opt.disabledClipboard||Object(m["sb"])(Object(m["q"])(this.beingCopyData)))}cut(){this.mindMap.execCommand("CUT_NODE",t=>{this.beingCopyData=t,this.mindMap.opt.disabledClipboard||Object(m["sb"])(Object(m["q"])(t))})}handlePaste(t){const{disabledClipboard:e}=this.mindMap.opt;if(e)return;const i=t.clipboardData||t.originalEvent.clipboardData,n=i.items;let s=null,a="";Array.from(n).forEach(t=>{t.type.indexOf("image")>-1&&(s=t.getAsFile()),t.type.indexOf("text")>-1&&(a=i.getData("text"))}),this.paste()}async paste(){const{errorHandler:t,handleIsSplitByWrapOnPasteCreateNewNode:e,handleNodePasteImg:i,disabledClipboard:n,onlyPasteTextWhenHasImgAndText:s}=this.mindMap.opt;if(!n&&Object(m["f"])())try{const n=await Object(m["E"])();let o=n.text||"",d=n.img||null;if(o){let i=null,n=!0;if(this.mindMap.opt.customHandleClipboardText)try{const t=await this.mindMap.opt.customHandleClipboardText(o);if(!Object(m["bb"])(t)){n=!1;const e=Object(m["k"])(t);e.isSmm?i=e.data:o=e.data}}catch(a){t(p["b"].CUSTOM_HANDLE_CLIPBOARD_TEXT_ERROR,a)}if(n){const t=Object(m["k"])(o);t.isSmm?i=t.data:o=t.data}if(i)this.mindMap.execCommand("INSERT_MULTI_CHILD_NODE",[],Array.isArray(i)?i:[i]);else{this.hasRichTextPlugin()&&(o=Object(m["V"])(o));const t=o.split(new RegExp("\r?\n|(?<!\n)\r","g")).filter(t=>!!t);t.length>1&&e?e().then(()=>{this.mindMap.execCommand("INSERT_MULTI_CHILD_NODE",[],t.map(t=>({data:{text:t},children:[]})))}).catch(()=>{this.mindMap.execCommand("INSERT_CHILD_NODE",!1,[],{text:o})}):this.mindMap.execCommand("INSERT_CHILD_NODE",!1,[],{text:o})}}if(d&&(!o||!s))try{let t=null;t=i&&"function"===typeof i?await i(d):await Object(m["db"])(d),this.activeNodeList.length>0&&this.activeNodeList.forEach(e=>{this.mindMap.execCommand("SET_NODE_IMAGE",e,{url:t.url,title:"",width:t.size.width,height:t.size.height})})}catch(a){t(p["b"].LOAD_CLIPBOARD_IMAGE_ERROR,a)}}catch(a){t(p["b"].READ_CLIPBOARD_ERROR,a)}else this.beingCopyData&&this.mindMap.execCommand("PASTE_NODE",this.beingCopyData)}insertBefore(t,e){this.insertTo(t,e,"before")}insertAfter(t,e){this.insertTo(t,e,"after")}insertTo(t,e,i="before"){let n=Object(m["y"])(t);n=n.filter(t=>!t.isRoot),"after"===i&&n.reverse(),n.forEach(t=>{let n=t.parent,s=n.children,a=Object(m["H"])(t,s);if(-1===a)return;s.splice(a,1),n.nodeData.children.splice(a,1);let o=e.parent,d=o.children,h=Object(m["H"])(e,d);-1!==h&&("after"===i&&h++,d.splice(h,0,t),o.nodeData.children.splice(h,0,t.nodeData))}),this.mindMap.render()}removeNode(t=[]){if(t=Object(m["y"])(t),this.activeNodeList.length<=0&&t.length<=0)return;let e=null,i=t.length>0,n=i?t:this.activeNodeList,s=n.find(t=>t.isRoot);if(s)this.clearActiveNodeList(),s.children=[],s.nodeData.children=[];else{e=this.getNextActiveNode(n);for(let t=0;t<n.length;t++){const e=n[t],s=this.textEdit.getCurrentEditNode();s&&s.getData("uid")===e.getData("uid")&&this.textEdit.hideEditTextBox(),i&&n.splice(t,1),e.isGeneralization?(this.deleteNodeGeneralization(e),this.removeNodeFromActiveList(e),t--):(this.removeNodeFromActiveList(e),Object(m["lb"])(e),t--)}}this.activeNodeList=[],e&&this.addNodeToActiveList(e),this.emitNodeActiveEvent(),this.mindMap.render()}deleteNodeGeneralization(t){const e=t.generalizationBelongNode,i=e.getGeneralizationNodeIndex(t);let n=e.getData("generalization");Array.isArray(n)?n.splice(i,1):n=null,this.mindMap.execCommand("SET_NODE_DATA",e,{generalization:n}),this.closeHighlightNode()}removeCurrentNode(t=[]){if(t=Object(m["y"])(t),this.activeNodeList.length<=0&&t.length<=0)return;let e=t.length>0,i=e?t:this.activeNodeList;i=i.filter(t=>!t.isRoot);let n=this.getNextActiveNode(i);for(let s=0;s<i.length;s++){let t=i[s];if(t.isGeneralization)this.deleteNodeGeneralization(t);else{const e=t.parent,i=Object(m["G"])(t);e.nodeData.children.splice(i,1,...t.nodeData.children||[])}}this.activeNodeList=[],n&&this.addNodeToActiveList(n),this.emitNodeActiveEvent(),this.mindMap.render()}getNextActiveNode(t){if(1!==t.length)return null;if(-1===this.findActiveNodeIndex(t[0]))return null;let e=null;if(1===this.activeNodeList.length&&!this.activeNodeList[0].isGeneralization&&this.mindMap.opt.deleteNodeActive){const t=this.activeNodeList[0],i=t.parent.children,n=Object(m["H"])(t,i);e=n<i.length-1?i[n+1]:n>0?i[n-1]:t.parent}return e}copyNode(){if(this.activeNodeList.length<=0)return null;let t=Object(m["P"])(this.activeNodeList);return t=Object(m["ub"])(t),t.map(t=>Object(m["n"])({},t,!0))}cutNode(t){if(this.activeNodeList.length<=0)return;let e=Object(m["P"])(this.activeNodeList).filter(t=>!t.isRoot);e=Object(m["ub"])(e);const i=e.map(t=>Object(m["n"])({},t,!0));e.forEach(t=>{Object(m["lb"])(t)}),this.clearActiveNodeList(),this.mindMap.render(),t&&"function"===typeof t&&t(i)}moveNodeTo(t,e){let i=Object(m["y"])(t);i=i.filter(t=>!t.isRoot),i.forEach(t=>{this.removeNodeFromActiveList(t),Object(m["lb"])(t),e.setData({expand:!0}),e.nodeData.children.push(t.nodeData)}),this.emitNodeActiveEvent(),this.mindMap.render()}pasteNode(t){t=Object(m["y"])(t),this.mindMap.execCommand("INSERT_MULTI_CHILD_NODE",[],t)}setNodeStyle(t,e,i){const n={[e]:i};this.setNodeDataRender(t,n),N["c"].includes(e)&&(t.parent||t).renderLine(!0)}setNodeStyles(t,e){const i={...e};this.setNodeDataRender(t,i);let n=Object.keys(e),s=!1;n.forEach(t=>{N["c"].includes(t)&&(s=!0)}),s&&(t.parent||t).renderLine(!0)}setNodeActive(t,e){this.mindMap.execCommand("SET_NODE_DATA",t,{isActive:e}),t.updateNodeByActive(e)}setNodeExpand(t,e){this.mindMap.execCommand("SET_NODE_DATA",t,{expand:e}),this.mindMap.render()}expandAllNode(t=""){if(!this.renderTree)return;const e=(i,n)=>{n||i.data.uid!==t||(n=!0),n&&!i.data.expand&&(i.data.expand=!0),i.children&&i.children.length>0&&i.children.forEach(t=>{e(t,n)})};e(this.renderTree,!t),this.mindMap.render()}unexpandAllNode(t=!0,e=""){if(!this.renderTree)return;const i=(t,n,s)=>{s||t.data.uid!==e||(s=!0),s&&!n&&t.children&&t.children.length>0&&(t.data.expand=!1),t.children&&t.children.length>0&&t.children.forEach(t=>{i(t,!1,s)})};i(this.renderTree,!0,!e),this.mindMap.render(()=>{t&&this.setRootNodeCenter()})}expandToLevel(t){this.renderTree&&(Object(m["yb"])(this.renderTree,null,(e,i,n,s)=>{const a=s<t;a?e.data.expand=!0:!n&&e.children&&e.children.length>0&&(e.data.expand=!1)},null,!0,0,0),this.mindMap.render())}toggleActiveExpand(){this.activeNodeList.forEach(t=>{t.nodeData.children.length<=0||t.isRoot||this.toggleNodeExpand(t)})}toggleNodeExpand(t){this.mindMap.execCommand("SET_NODE_EXPAND",t,!t.getData("expand"))}setNodeText(t,e,i,n){i=void 0===i?t.getData("richText"):i,this.setNodeDataRender(t,{text:e,richText:i,resetRichText:n})}setNodeImage(t,e){const{url:i,title:n,width:s,height:a,custom:o=!1}=e||{url:"",title:"",width:0,height:0,custom:!1};this.setNodeDataRender(t,{image:i,imageTitle:n||"",imageSize:{width:s,height:a,custom:o}})}setNodeIcon(t,e){this.setNodeDataRender(t,{icon:e})}setNodeHyperlink(t,e,i=""){this.setNodeDataRender(t,{hyperlink:e,hyperlinkTitle:i})}setNodeNote(t,e){this.setNodeDataRender(t,{note:e})}setNodeAttachment(t,e,i=""){this.setNodeDataRender(t,{attachmentUrl:e,attachmentName:i})}setNodeTag(t,e){this.setNodeDataRender(t,{tag:e})}insertFormula(t,e=[]){if(!this.hasRichTextPlugin()||!this.mindMap.formula)return;e=Object(m["y"])(e);const i=e.length>0?e:this.activeNodeList;i.forEach(e=>{this.mindMap.formula.insertFormulaToNode(e,t)})}addGeneralization(t,e=!0){if(this.activeNodeList.length<=0)return;const i=this.activeNodeList.filter(t=>!t.isRoot&&!t.isGeneralization&&!t.checkHasSelfGeneralization()),n=Object(m["ib"])(i);if(n.length<=0)return;const s=this.hasRichTextPlugin(),{focusNewNode:a,inserting:o}=this.getNewNodeBehavior(e,n.length>1);let d=!1;const h=t&&t.richText;n.forEach(e=>{const i={inserting:o,...t||{text:this.mindMap.opt.defaultGeneralizationText},range:e.range||null,uid:Object(m["r"])(),richText:s,isActive:a};s&&!h&&(i.resetRichText=s);let n=e.node.getData("generalization");if(n=n?Array.isArray(n)?n:[n]:[],e.range){const t=!!n.find(t=>t.range&&t.range[0]===e.range[0]&&t.range[1]===e.range[1]);if(t)return;n.push(i)}else n.push(i);d=!0,this.mindMap.execCommand("SET_NODE_DATA",e.node,{generalization:n}),e.node.setData({expand:!0})}),d&&(a&&this.clearActiveNodeList(),this.mindMap.render(()=>{this.mindMap.render()}))}removeGeneralization(){this.activeNodeList.length<=0||(this.activeNodeList.forEach(t=>{t.checkHasGeneralization()&&this.mindMap.execCommand("SET_NODE_DATA",t,{generalization:null})}),this.mindMap.render(),this.closeHighlightNode())}setNodeCustomPosition(t,e,i){let n=[t]||!1;n.forEach(t=>{this.mindMap.execCommand("SET_NODE_DATA",t,{customLeft:e,customTop:i})})}resetLayout(){Object(m["yb"])(this.root,null,t=>{t.customLeft=void 0,t.customTop=void 0,this.mindMap.execCommand("SET_NODE_DATA",t,{customLeft:void 0,customTop:void 0}),this.mindMap.render()},null,!0,0,0)}setNodeShape(t,e){if(!e||!x["b"].includes(e))return;let i=[t]||!1;i.forEach(t=>{this.setNodeStyle(t,"shape",e)})}goTargetNode(t,e=(()=>{})){let i="string"===typeof t?t:t.getData("uid");i&&this.expandToNodeUid(i,()=>{let t=this.findNodeByUid(i);t&&(t.active(),this.moveNodeToCenter(t),e(t))})}setNodeData(t,e){Object.keys(e).forEach(i=>{t.nodeData.data[i]=e[i]})}setNodeDataRender(t,e,i=!1){this.mindMap.execCommand("SET_NODE_DATA",t,e),Object(m["Y"])(e)?this.mindMap.emit("node_tree_render_end"):this.reRenderNodeCheckChange(t,i)}reRenderNodeCheckChange(t,e){let i=t.reRender();i?e||this.mindMap.render():this.mindMap.emit("node_tree_render_end")}moveNodeToCenter(t,e){let{resetScaleOnMoveNodeToCenter:i}=this.mindMap.opt;void 0!==e&&(i=e);let{transform:n,state:s}=this.mindMap.view.getTransformData(),{left:a,top:o,width:d,height:h}=t;i||(a*=n.scaleX,o*=n.scaleY,d*=n.scaleX,h*=n.scaleY);let r=this.mindMap.width/2,l=this.mindMap.height/2,c=a+d/2,m=o+h/2,p=r-s.x,g=l-s.y,u=p-c,x=g-m;this.mindMap.view.translateX(u),this.mindMap.view.translateY(x),i&&this.mindMap.view.setScale(1)}setRootNodeCenter(){this.moveNodeToCenter(this.root)}expandToNodeUid(t,e=(()=>{})){if(!this.renderTree)return void e();let i=[],n=!1;const s={};Object(m["d"])(this.renderTree,(e,a)=>{if(e.data.uid===t)return i=a?[...s[a.data.uid],a]:[],"stop";const o=Object(m["z"])(e.data);if(o.forEach(o=>{o.uid===t&&(i=a?[...s[a.data.uid],a,e]:[],n=!0)}),n)return"stop";s[e.data.uid]=a?[...s[a.data.uid],a]:[]});let a=!1;if(i.forEach(t=>{t.data.expand||(a=!0,t.data.expand=!0)}),n){const t=i[i.length-1];t&&Object(m["yb"])(t,null,t=>{t.data.expand||(a=!0,t.data.expand=!0)})}a?this.mindMap.render(e):e()}findNodeByUid(t){if(!this.root)return;let e=null;return Object(m["yb"])(this.root,null,i=>{if(i.getData("uid")===t)return e=i,!0;let n=!1;return(i._generalizationList||[]).forEach(i=>{i.generalizationNode.getData("uid")===t&&(e=i.generalizationNode,n=!0)}),!!n||void 0}),e}highlightNode(t,e,i){if(this.isRendering)return;i={stroke:"rgb(94, 200, 248)",fill:"transparent",...i||{}},this.highlightBoxNode?this.highlightBoxNodeStyle&&(this.highlightBoxNodeStyle.stroke===i.stroke&&this.highlightBoxNodeStyle.fill===i.fill||this.highlightBoxNode.stroke({color:i.stroke||"transparent"}).fill({color:i.fill||"transparent"})):this.highlightBoxNode=(new E["g"]).stroke({color:i.stroke||"transparent"}).fill({color:i.fill||"transparent"}),this.highlightBoxNodeStyle={...i};let n=1/0,s=1/0,a=-1/0,o=-1/0;if(e){const i=t.children.slice(e[0],e[1]+1);i.forEach(t=>{t.left<n&&(n=t.left),t.top<s&&(s=t.top);const e=t.left+t.width,i=t.top+t.height;e>a&&(a=e),i>o&&(o=i)})}else n=t.left,s=t.top,a=t.left+t.width,o=t.top+t.height;this.highlightBoxNode.plot([[n,s],[a,s],[a,o],[n,o]]),this.mindMap.otherDraw.add(this.highlightBoxNode)}closeHighlightNode(){this.highlightBoxNode&&this.highlightBoxNode.remove()}hasRichTextPlugin(){return!!this.mindMap.richText}}e["a"]=_},d2b6:function(t,e,i){"use strict";var n=i("6ac9");class s{constructor(t={}){this.opt=t,this.mindMap=this.opt.mindMap,this.scale=1,this.sx=0,this.sy=0,this.x=0,this.y=0,this.firstDrag=!0,this.setTransformData(this.mindMap.opt.viewData),this.bind()}bind(){this.mindMap.keyCommand.addShortcut("Control+=",()=>{this.enlarge()}),this.mindMap.keyCommand.addShortcut("Control+-",()=>{this.narrow()}),this.mindMap.keyCommand.addShortcut("Control+i",()=>{this.fit()}),this.mindMap.event.on("mousedown",t=>{const{isDisableDrag:e,mousedownEventPreventDefault:i}=this.mindMap.opt;e||(i&&t.preventDefault(),this.sx=this.x,this.sy=this.y)}),this.mindMap.event.on("drag",(t,e)=>{t.ctrlKey||t.metaKey||this.mindMap.opt.isDisableDrag||(this.firstDrag&&(this.firstDrag=!1,this.mindMap.renderer.activeNodeList.length>0&&this.mindMap.execCommand("CLEAR_ACTIVE_NODE")),this.x=this.sx+e.mousemoveOffset.x,this.y=this.sy+e.mousemoveOffset.y,this.transform())}),this.mindMap.event.on("mouseup",()=>{this.firstDrag=!0}),this.mindMap.event.on("mousewheel",(t,e,i,s)=>{const{customHandleMousewheel:a,mousewheelAction:o,mouseScaleCenterUseMousePosition:d,mousewheelMoveStep:h,mousewheelZoomActionReverse:r,disableMouseWheelZoom:l,translateRatio:c}=this.mindMap.opt;if(a&&"function"===typeof a)return a(t);if(o===n["a"].MOUSE_WHEEL_ACTION.ZOOM||t.ctrlKey||t.metaKey){if(l)return;const{x:i,y:a}=this.mindMap.toPos(t.clientX,t.clientY),o=d?i:void 0,h=d?a:void 0;switch(s&&(e.includes(n["a"].DIR.LEFT)||e.includes(n["a"].DIR.RIGHT))&&(e=e.filter(t=>![n["a"].DIR.LEFT,n["a"].DIR.RIGHT].includes(t))),!0){case e.includes(n["a"].DIR.UP||n["a"].DIR.LEFT):r?this.enlarge(o,h,s):this.narrow(o,h,s);break;case e.includes(n["a"].DIR.DOWN||n["a"].DIR.RIGHT):r?this.narrow(o,h,s):this.enlarge(o,h,s);break}}else{let i=0,a=0;s?(i=Math.abs(t.wheelDeltaX),a=Math.abs(t.wheelDeltaY)):i=a=h;let o=0,d=0;e.includes(n["a"].DIR.DOWN)&&(d=-a),e.includes(n["a"].DIR.UP)&&(d=a),e.includes(n["a"].DIR.LEFT)&&(o=i),e.includes(n["a"].DIR.RIGHT)&&(o=-i),this.translateXY(o*c,d*c)}}),this.mindMap.on("resize",()=>{this.checkNeedMindMapInCanvas()&&this.transform()})}getTransformData(){return{transform:this.mindMap.draw.transform(),state:{scale:this.scale,x:this.x,y:this.y,sx:this.sx,sy:this.sy}}}setTransformData(t){t&&(Object.keys(t.state).forEach(e=>{this[e]=t.state[e]}),this.mindMap.draw.transform({...t.transform}),this.mindMap.emit("view_data_change",this.getTransformData()),this.emitEvent("scale"),this.emitEvent("translate"))}translateXY(t,e){0===t&&0===e||(this.x+=t,this.y+=e,this.transform(),this.emitEvent("translate"))}translateX(t){0!==t&&(this.x+=t,this.transform(),this.emitEvent("translate"))}translateXTo(t){this.x=t,this.transform(),this.emitEvent("translate")}translateY(t){0!==t&&(this.y+=t,this.transform(),this.emitEvent("translate"))}translateYTo(t){this.y=t,this.transform(),this.emitEvent("translate")}transform(){try{this.limitMindMapInCanvas()}catch(t){}this.mindMap.draw.transform({origin:[0,0],scale:this.scale,translate:[this.x,this.y]}),this.mindMap.emit("view_data_change",this.getTransformData())}reset(){const t=1!==this.scale,e=0!==this.x||0!==this.y;this.scale=1,this.x=0,this.y=0,this.transform(),t&&this.emitEvent("scale"),e&&this.emitEvent("translate")}narrow(t,e,i){let{scaleRatio:n,minZoomRatio:s}=this.mindMap.opt;n/=i?5:1;const a=Math.max(this.scale-n,s/100);this.scaleInCenter(a,t,e),this.transform(),this.emitEvent("scale")}enlarge(t,e,i){let{scaleRatio:n,maxZoomRatio:s}=this.mindMap.opt;n/=i?5:1;let a=0;a=-1===s?this.scale+n:Math.min(this.scale+n,s/100),this.scaleInCenter(a,t,e),this.transform(),this.emitEvent("scale")}scaleInCenter(t,e,i){void 0!==e&&void 0!==i||(e=this.mindMap.width/2,i=this.mindMap.height/2);const n=this.scale,s=1-t/n,a=(e-this.x)*s,o=(i-this.y)*s;this.x+=a,this.y+=o,this.scale=t}setScale(t,e,i){void 0!==e&&void 0!==i?this.scaleInCenter(t,e,i):this.scale=t,this.transform(),this.emitEvent("scale")}fit(t=(()=>{}),e=!1,i){i=void 0===i?this.mindMap.opt.fitPadding:i;const n=this.mindMap.draw,s=n.transform(),a=t()||n.rbox(),o=a.width/s.scaleX,d=a.height/s.scaleY,h=o/d;let{width:r,height:l}=this.mindMap.elRect;r-=2*i,l-=2*i;const c=r/l;let m=0,p="";if(o<=r&&d<=l&&!e)m=1,p=1;else{let t=0,e=0;h>c?(t=r,e=r/h,p=2):(e=l,t=l*h,p=3),m=t/o}this.setScale(m);const g=t()||n.rbox();g.x-=this.mindMap.elRect.left,g.y-=this.mindMap.elRect.top;let u=0,x=0;1===p?(u=-g.x+i+(r-g.width)/2,x=-g.y+i+(l-g.height)/2):2===p?(u=-g.x+i,x=-g.y+i+(l-g.height)/2):3===p&&(u=-g.x+i+(r-g.width)/2,x=-g.y+i),this.translateXY(u,x)}checkNeedMindMapInCanvas(){if(this.mindMap.demonstrate&&this.mindMap.demonstrate.isInDemonstrate)return!1;const{isLimitMindMapInCanvasWhenHasScrollbar:t,isLimitMindMapInCanvas:e}=this.mindMap.opt;return this.mindMap.scrollbar?t:e}limitMindMapInCanvas(){if(!this.checkNeedMindMapInCanvas())return;let{scale:t,left:e,top:i,right:n,bottom:s}=this.getPositionLimit();const a=(this.mindMap.width-this.mindMap.initWidth)/2*t,o=(this.mindMap.height-this.mindMap.initHeight)/2*t,d=this.scale/t;e*=d,n*=d,i*=d,s*=d;const h=this.mindMap.width/2,r=this.mindMap.height/2,l=this.scale-1;e-=l*h-a,n-=l*h-a,i-=l*r-o,s-=l*r-o,this.x>e&&(this.x=e),this.x<n&&(this.x=n),this.y>i&&(this.y=i),this.y<s&&(this.y=s)}getPositionLimit(){const{scaleX:t,scaleY:e}=this.mindMap.draw.transform(),i=this.mindMap.draw.rbox(),n=this.mindMap.renderer.root.group.rbox(),s=this.mindMap.renderer.layout.getRootCenterOffset(n.width,n.height),a=n.x-i.x-s.x*t,o=n.x-i.x2-s.x*t,d=n.y-i.y-s.y*e,h=n.y-i.y2-s.y*e;return{scale:t,left:a,right:o,top:d,bottom:h}}emitEvent(t){switch(t){case"scale":this.mindMap.emit("scale",this.scale);case"translate":this.mindMap.emit("translate",this.x,this.y)}}}e["a"]=s}}]);