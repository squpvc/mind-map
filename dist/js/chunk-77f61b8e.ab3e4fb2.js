(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-77f61b8e"],{"11c8":function(e,t,i){},1906:function(e,t,i){"use strict";var a=function(){var e=this,t=e._self._c;return t("div",[t("el-dialog",{staticClass:"clientTipDialog",attrs:{title:e.$t("ai.connectFailedTitle"),visible:e.clientTipDialogVisible,width:"400px","append-to-body":""},on:{"update:visible":function(t){e.clientTipDialogVisible=t}}},[t("div",{staticClass:"tipBox"},[t("p",[e._v(e._s(e.$t("ai.connectFailedTip")))]),t("p",[e._v(" "+e._s(e.$t("ai.connectFailedCheckTip1"))),t("a",{attrs:{href:"https://pan.baidu.com/s/1huasEbKsGNH2Af68dvWiOg?pwd=3bp3"}},[e._v(e._s(e.$t("ai.baiduNetdisk")))]),e._v("ã€"),t("a",{attrs:{href:"https://github.com/wanglin2/mind-map/releases"}},[e._v("Github")])]),t("p",[e._v(e._s(e.$t("ai.connectFailedCheckTip2")))]),t("P",[e._v(e._s(e.$t("ai.connectFailedCheckTip3")))]),t("p",[e._v(" "+e._s(e.$t("ai.connectFailedCheckTip4"))),t("el-button",{attrs:{size:"small"},on:{click:e.testConnect}},[e._v(e._s(e.$t("ai.connectionDetection")))])],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.clientTipDialogVisible=!1}}},[e._v(e._s(e.$t("ai.close")))])],1)]),t("el-dialog",{staticClass:"createDialog",attrs:{title:e.$t("ai.createMindMapTitle"),visible:e.createDialogVisible,width:"450px","append-to-body":""},on:{"update:visible":function(t){e.createDialogVisible=t}}},[t("div",{staticClass:"inputBox"},[t("el-input",{attrs:{type:"textarea",rows:5,placeholder:e.$t("ai.createTip")},model:{value:e.aiInput,callback:function(t){e.aiInput=t},expression:"aiInput"}}),t("div",{staticClass:"tip warning"},[e._v(" "+e._s(e.$t("ai.importantTip"))+" ")]),t("div",{staticClass:"tip"},[e._v(" "+e._s(e.$t("ai.wantModifyAiConfigTip"))),t("el-button",{attrs:{size:"small"},on:{click:e.showAiConfigDialog}},[e._v(e._s(e.$t("ai.modifyAIConfiguration")))])],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.closeAiCreateDialog}},[e._v(e._s(e.$t("ai.cancel")))]),t("el-button",{attrs:{type:"primary"},on:{click:e.doAiCreate}},[e._v(e._s(e.$t("ai.confirm")))])],1)]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.aiCreatingMaskVisible,expression:"aiCreatingMaskVisible"}],ref:"aiCreatingMaskRef",staticClass:"aiCreatingMask"},[t("el-button",{staticClass:"btn",attrs:{type:"warning"},on:{click:e.stopCreate}},[e._v(e._s(e.$t("ai.stopGenerating")))])],1),t("AiConfigDialog",{model:{value:e.aiConfigDialogVisible,callback:function(t){e.aiConfigDialogVisible=t},expression:"aiConfigDialogVisible"}}),t("el-dialog",{staticClass:"createDialog",attrs:{title:e.$t("ai.aiCreatePart"),visible:e.createPartDialogVisible,width:"450px","append-to-body":""},on:{"update:visible":function(t){e.createPartDialogVisible=t}}},[t("div",{staticClass:"inputBox"},[t("el-input",{attrs:{type:"textarea",rows:5},model:{value:e.aiPartInput,callback:function(t){e.aiPartInput=t},expression:"aiPartInput"}})],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.closeAiCreatePartDialog}},[e._v(e._s(e.$t("ai.cancel")))]),t("el-button",{attrs:{type:"primary"},on:{click:e.confirmAiCreatePart}},[e._v(e._s(e.$t("ai.confirm")))])],1)])],1)},s=[],r=(i("d9e2"),i("14d9"),i("0643"),i("4e3e"),i("a573"),i("6cec")),o=i("90b8"),n=i("d17d"),l=i("2f62"),c=function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"aiConfigDialog",attrs:{title:e.$t("ai.AIConfiguration")+(e.currentProviderName?" - "+e.currentProviderName:""),visible:e.aiConfigDialogVisible,width:"750px","append-to-body":"","close-on-click-modal":!1},on:{"update:visible":function(t){e.aiConfigDialogVisible=t}}},[t("div",{staticClass:"aiConfigBox"},[t("el-form",{ref:"ruleFormRef",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"160px","label-position":"left"}},[t("el-form-item",{staticClass:"provider-selection",attrs:{label:e.$t("ai.provider"),prop:"provider"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("ai.selectProvider"),filterable:""},on:{change:e.handleProviderChange},model:{value:e.ruleForm.provider,callback:function(t){e.$set(e.ruleForm,"provider",t)},expression:"ruleForm.provider"}},e._l(Object.entries(e.providerNames),(function([i,a]){return t("el-option",{key:i,attrs:{label:a,value:i}},[t("div",{staticClass:"provider-option"},[t("span",{staticClass:"provider-name"},[e._v(e._s(a))]),t("span",{staticClass:"provider-id"},[e._v(e._s(i))])])])})),1)],1),e.showApiKeyField?t("div",{staticClass:"provider-config-section"},[t("el-form-item",{attrs:{label:e.$t("ai.apiKey"),prop:"apiKey",rules:[{required:!0,message:e.$t("ai.apiKeyRequired"),trigger:"blur"}]}},[t("el-input",{attrs:{placeholder:e.$t("ai.enterApiKey"),"show-password":"",clearable:""},scopedSlots:e._u([{key:"suffix",fn:function(){return[e.providerApiKeyHelp[e.ruleForm.provider]?t("el-tooltip",{attrs:{content:e.providerApiKeyHelp[e.ruleForm.provider],placement:"top"}},[t("i",{staticClass:"el-icon-info",staticStyle:{color:"var(--el-color-primary)",cursor:"help"}})]):e._e()]},proxy:!0}],null,!1,2658283741),model:{value:e.ruleForm.apiKey,callback:function(t){e.$set(e.ruleForm,"apiKey",t)},expression:"ruleForm.apiKey"}})],1),e.showBaseUrlField?t("el-form-item",{attrs:{label:e.$t("ai.baseUrl"),prop:"baseUrl",rules:[{required:e.requiresBaseUrl,message:e.$t("ai.baseUrlRequired"),trigger:"blur"}]}},[t("el-input",{attrs:{placeholder:e.defaultBaseUrls[e.ruleForm.provider]||"https://api.example.com/v1",clearable:""},model:{value:e.ruleForm.baseUrl,callback:function(t){e.$set(e.ruleForm,"baseUrl",t)},expression:"ruleForm.baseUrl"}})],1):e._e(),e.ruleForm.provider===e.AI_PROVIDERS.AZURE?t("el-form-item",{attrs:{label:e.$t("ai.apiVersion"),prop:"apiVersion",rules:[{required:!0,message:e.$t("ai.apiVersionRequired"),trigger:"blur"}]}},[t("el-input",{attrs:{placeholder:"2023-05-15"},model:{value:e.ruleForm.apiVersion,callback:function(t){e.$set(e.ruleForm,"apiVersion",t)},expression:"ruleForm.apiVersion"}})],1):e._e(),e.ruleForm.provider===e.AI_PROVIDERS.AZURE?t("el-form-item",{attrs:{label:e.$t("ai.deploymentId"),prop:"deploymentId",rules:[{required:!0,message:e.$t("ai.deploymentIdRequired"),trigger:"blur"}]}},[t("el-input",{attrs:{placeholder:"your-deployment-id"},model:{value:e.ruleForm.deploymentId,callback:function(t){e.$set(e.ruleForm,"deploymentId",t)},expression:"ruleForm.deploymentId"}})],1):e._e()],1):e._e(),e.showModelSelection?t("el-form-item",{attrs:{label:e.$t("ai.model"),prop:"model",rules:[{required:!0,message:e.$t("ai.modelRequired"),trigger:"change"}]}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("ai.selectModel"),filterable:""},model:{value:e.ruleForm.model,callback:function(t){e.$set(e.ruleForm,"model",t)},expression:"ruleForm.model"}},e._l(e.availableModels,(function(i){return t("el-option",{key:i.id,attrs:{label:i.name,value:i.id}},[t("div",{staticClass:"model-option"},[t("span",{staticClass:"model-name"},[e._v(e._s(i.name))]),t("span",{staticClass:"model-id"},[e._v(e._s(i.id))])])])})),1)],1):e._e(),e.showCustomModelInput?t("el-form-item",{attrs:{label:e.$t("ai.customModel"),prop:"customModel",rules:[{required:!0,message:e.$t("ai.customModelRequired"),trigger:"blur"}]}},[t("el-input",{attrs:{placeholder:e.$t("ai.enterCustomModel")},model:{value:e.ruleForm.customModel,callback:function(t){e.$set(e.ruleForm,"customModel",t)},expression:"ruleForm.customModel"}})],1):e._e(),t("el-collapse",{staticClass:"advanced-settings",model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[t("el-collapse-item",{attrs:{title:e.$t("ai.advancedSettings"),name:"1"}},[t("el-form-item",{attrs:{label:e.$t("ai.temperature"),prop:"temperature"}},[t("el-slider",{attrs:{min:0,max:2,step:.1,"show-stops":"",marks:e.temperatureMarks},model:{value:e.ruleForm.temperature,callback:function(t){e.$set(e.ruleForm,"temperature",t)},expression:"ruleForm.temperature"}}),t("div",{staticClass:"slider-tip"},[t("span",[e._v(e._s(e.$t("ai.precise")))]),t("span",[e._v(e._s(e.$t("ai.balanced")))]),t("span",[e._v(e._s(e.$t("ai.creative")))])])],1),t("el-form-item",{attrs:{label:e.$t("ai.maxTokens"),prop:"maxTokens"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{min:100,max:e.maxMaxTokens,step:100,placeholder:e.$t("ai.maxTokensPlaceholder")},model:{value:e.ruleForm.maxTokens,callback:function(t){e.$set(e.ruleForm,"maxTokens",t)},expression:"ruleForm.maxTokens"}}),t("div",{staticClass:"slider-tip"},[t("span",[e._v(e._s(e.$t("ai.maxTokensTip")))])])],1),t("el-form-item",{attrs:{label:e.$t("ai.topP"),prop:"topP"}},[t("el-slider",{attrs:{min:0,max:1,step:.1,"show-stops":""},model:{value:e.ruleForm.topP,callback:function(t){e.$set(e.ruleForm,"topP",t)},expression:"ruleForm.topP"}}),t("div",{staticClass:"slider-tip"},[t("span",[e._v(e._s(e.$t("ai.deterministic")))]),t("span",[e._v(e._s(e.$t("ai.diverse")))])])],1),t("el-form-item",{attrs:{label:e.$t("ai.presencePenalty"),prop:"presencePenalty"}},[t("el-slider",{attrs:{min:-2,max:2,step:.1,marks:e.penaltyMarks,"show-stops":""},model:{value:e.ruleForm.presencePenalty,callback:function(t){e.$set(e.ruleForm,"presencePenalty",t)},expression:"ruleForm.presencePenalty"}})],1),t("el-form-item",{attrs:{label:e.$t("ai.frequencyPenalty"),prop:"frequencyPenalty"}},[t("el-slider",{attrs:{min:-2,max:2,step:.1,marks:e.penaltyMarks,"show-stops":""},model:{value:e.ruleForm.frequencyPenalty,callback:function(t){e.$set(e.ruleForm,"frequencyPenalty",t)},expression:"ruleForm.frequencyPenalty"}})],1),t("el-form-item",{attrs:{label:e.$t("ai.timeout"),prop:"timeout"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{min:10,max:600,step:5,formatter:e=>e+"s",parser:e=>e.replace("s","")},model:{value:e.ruleForm.timeout,callback:function(t){e.$set(e.ruleForm,"timeout",t)},expression:"ruleForm.timeout"}})],1)],1)],1),e.currentProviderDocs||e.providerHelpText[e.ruleForm.provider]?t("div",{staticClass:"provider-help"},[e.providerHelpText[e.ruleForm.provider]?t("el-alert",{staticClass:"provider-help-text",attrs:{title:e.providerHelpText[e.ruleForm.provider],type:"info",closable:!1,"show-icon":""}}):e._e(),e.currentProviderDocs?t("div",{staticClass:"provider-docs"},[t("el-link",{staticClass:"docs-link",attrs:{type:"primary",href:e.currentProviderDocs,target:"_blank",underline:!1}},[t("i",{staticClass:"el-icon-link"}),e._v(" "+e._s(e.$t("ai.viewDocumentation",{provider:e.providerNames[e.ruleForm.provider]}))+" "),t("i",{staticClass:"el-icon-arrow-right"})])],1):e._e()],1):e._e()],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{disabled:e.isSaving},on:{click:e.cancel}},[e._v(e._s(e.$t("ai.cancel")))]),t("el-button",{attrs:{type:"primary",loading:e.isSaving,disabled:!e.isFormValid},on:{click:e.confirm}},[e._v(" "+e._s(e.isSaving?e.$t("ai.saving"):e.$t("ai.save"))+" ")])],1)])},d=[],p=i("677d"),h={model:{prop:"visible",event:"change"},props:{visible:{type:Boolean,default:!1}},data(){return{AI_PROVIDERS:p["b"],isSaving:!1,activeNames:["1"],ruleForm:{provider:p["d"],apiKey:"",baseUrl:"",apiVersion:"2023-05-15",deploymentId:"",model:"",customModel:"",temperature:p["e"].temperature,maxTokens:p["e"].maxTokens,topP:p["e"].topP,frequencyPenalty:p["e"].frequencyPenalty,presencePenalty:p["e"].presencePenalty,timeout:60},providerNames:p["c"],providerDocs:function(){var e={};return e[p["b"].OPENAI]="https://platform.openai.com/docs/api-reference",e[p["b"].ANTHROPIC]="https://docs.anthropic.com/claude/reference",e[p["b"].DEEPSEEK]="https://platform.deepseek.com/docs",e[p["b"].GOOGLE]="https://ai.google.dev/api/rest",e[p["b"].MISTRAL]="https://docs.mistral.ai/",e[p["b"].COHERE]="https://docs.cohere.com/reference",e[p["b"].VOLCANO]="https://www.volcengine.com/docs/82379",e[p["b"].GROQ]="https://console.groq.com/docs/introduction",e[p["b"].OLLAMA]="https://github.com/ollama/ollama",e[p["b"].LM_STUDIO]="https://lmstudio.ai/docs",e[p["b"].TOGETHER]="https://docs.together.ai/reference",e[p["b"].PERPLEXITY]="https://docs.perplexity.ai/",e[p["b"].OPENROUTER]="https://openrouter.ai/docs",e[p["b"].AZURE]="https://learn.microsoft.com/en-us/azure/ai-services/openai/",e[p["b"].AWS]="https://docs.aws.amazon.com/bedrock/latest/userguide/what-is-bedrock.html",e}(),providerApiKeyHelp:function(){var e={};return e[p["b"].OPENAI]="Find your API key at https://platform.openai.com/api-keys",e[p["b"].ANTHROPIC]="Find your API key at https://console.anthropic.com/settings/keys",e[p["b"].DEEPSEEK]="Find your API key at https://platform.deepseek.com/account/api-keys",e[p["b"].GOOGLE]="Get your API key from Google AI Studio",e[p["b"].MISTRAL]="Find your API key at https://console.mistral.ai/api-keys/",e[p["b"].COHERE]="Find your API key at https://dashboard.cohere.com/api-keys",e[p["b"].GROQ]="Find your API key at https://console.groq.com/keys",e[p["b"].OPENROUTER]="Find your API key at https://openrouter.ai/keys",e[p["b"].PERPLEXITY]="Find your API key at https://perplexity.ai/settings/api",e[p["b"].AZURE]="Find your API key in the Azure Portal",e[p["b"].AWS]="Configure AWS credentials with proper Bedrock permissions",e}(),providerHelpText:function(e){var t={};return t[p["b"].OLLAMA]=e.$t("ai.ollamaHelpText"),t[p["b"].LM_STUDIO]=e.$t("ai.lmStudioHelpText"),t[p["b"].OPENROUTER]=e.$t("ai.openRouterHelpText"),t}(this),defaultBaseUrls:function(){var e={};return e[p["b"].OPENAI]="https://api.openai.com/v1",e[p["b"].ANTHROPIC]="https://api.anthropic.com/v1",e[p["b"].DEEPSEEK]="https://api.deepseek.com/v1",e[p["b"].MISTRAL]="https://api.mistral.ai/v1",e[p["b"].COHERE]="https://api.cohere.ai/v1",e[p["b"].OLLAMA]="http://localhost:11434/v1",e[p["b"].LM_STUDIO]="http://localhost:1234/v1",e[p["b"].TOGETHER]="https://api.together.xyz/v1",e[p["b"].OPENROUTER]="https://openrouter.ai/api/v1",e[p["b"].PERPLEXITY]="https://api.perplexity.ai",e[p["b"].AZURE]="https://{your-resource-name}.openai.azure.com/openai/deployments/{deployment-id}",e}(),temperatureMarks:{0:"0",.5:"0.5",1:"1",1.5:"1.5",2:"2"},penaltyMarks:{"-2":"-2","-1":"-1",0:"0",1:"1",2:"2"},rules:{provider:[{required:!0,message:this.$t("ai.providerRequired"),trigger:"change"}],apiKey:[{required:!0,message:this.$t("ai.apiKeyRequired"),trigger:"blur"}],model:[{required:!0,message:this.$t("ai.modelRequired"),trigger:"change"}]}}},computed:Object.assign({},Object(l["c"])(["aiConfig"]),{availableModels:function(){return p["a"][this.ruleForm.provider]||[]},currentProviderName:function(){return this.providerNames[this.ruleForm.provider]||this.ruleForm.provider},currentProviderDocs:function(){return this.providerDocs[this.ruleForm.provider]},showApiKeyField:function(){return![p["b"].OLLAMA,p["b"].LM_STUDIO].includes(this.ruleForm.provider)},showBaseUrlField:function(){return[p["b"].OPENAI,p["b"].ANTHROPIC,p["b"].DEEPSEEK,p["b"].MISTRAL,p["b"].COHERE,p["b"].OLLAMA,p["b"].LM_STUDIO,p["b"].TOGETHER,p["b"].OPENROUTER,p["b"].PERPLEXITY].includes(this.ruleForm.provider)},requiresBaseUrl:function(){return[p["b"].OLLAMA,p["b"].LM_STUDIO].includes(this.ruleForm.provider)},showModelSelection:function(){return this.availableModels&&this.availableModels.length>0},showCustomModelInput:function(){return[p["b"].OLLAMA,p["b"].LM_STUDIO].includes(this.ruleForm.provider)},maxMaxTokens:function(){return this.ruleForm.provider===p["b"].ANTHROPIC?1e5:4e3},isFormValid:function(){return!!this.ruleForm.provider&&(!(this.showApiKeyField&&!this.ruleForm.apiKey)&&(!(this.requiresBaseUrl&&!this.ruleForm.baseUrl)&&!!(this.ruleForm.provider!==p["b"].AZURE||this.ruleForm.apiVersion&&this.ruleForm.deploymentId)))}}),watch:{visible:function(e){this.aiConfigDialogVisible=e},aiConfigDialogVisible:function(e,t){!e&&t?this.close():e&&this.initFormData()},"ruleForm.provider":function(){this.ruleForm.model=this.availableModels[0]&&this.availableModels[0].id||"",this.showBaseUrlField&&!this.ruleForm.baseUrl&&(this.ruleForm.baseUrl=this.defaultBaseUrls[this.ruleForm.provider]||"")}},created:function(){this.initFormData()},methods:{...Object(l["b"])(["setLocalConfig"]),close(){this.$emit("change",!1)},initFormData(){if(!this.aiConfig)return;const{provider:e=p["d"],apiKey:t="",baseUrl:i="",apiVersion:a="2023-05-15",deploymentId:s="",model:r="",customModel:o="",temperature:n=p["e"].temperature,maxTokens:l=p["e"].maxTokens,topP:c=p["e"].topP,frequencyPenalty:d=p["e"].frequencyPenalty,presencePenalty:h=p["e"].presencePenalty,timeout:u=60}=this.aiConfig;this.ruleForm={provider:e,apiKey:t,baseUrl:i||this.defaultBaseUrls[e]||"",apiVersion:a,deploymentId:s,model:r||this.availableModels[0]&&this.availableModels[0].id||"",customModel:o,temperature:parseFloat(n),maxTokens:parseInt(l),topP:parseFloat(c),frequencyPenalty:parseFloat(d),presencePenalty:parseFloat(h),timeout:parseInt(u)||60},!this.ruleForm.model&&this.availableModels.length>0&&(this.ruleForm.model=this.availableModels[0].id)},handleProviderChange(e){var t;this.ruleForm.model=(null===(t=this.availableModels[0])||void 0===t?void 0:t.id)||"",this.showBaseUrlField&&!this.ruleForm.baseUrl&&(this.ruleForm.baseUrl=this.defaultBaseUrls[e]||"")},cancel(){this.close(),this.initFormData()},async confirm(){this.isSaving=!0;try{await this.$refs.ruleFormRef.validate();const e={...this.ruleForm,apiKey:this.ruleForm.apiKey||"",model:this.ruleForm.model||this.availableModels[0]&&this.availableModels[0].id||"",baseUrl:this.ruleForm.baseUrl||this.defaultBaseUrls[this.ruleForm.provider]||"",...this.ruleForm.apiVersion?{apiVersion:this.ruleForm.apiVersion}:{},...this.ruleForm.deploymentId?{deploymentId:this.ruleForm.deploymentId}:{}};this.showCustomModelInput||delete e.customModel,this.setLocalConfig(e),this.$message.success(this.$t("ai.configSaveSuccessTip")),this.close()}catch(e){console.error("Validation failed:",e)}finally{this.isSaving=!1}}}},u=h,m=(i("e313"),i("2877")),g=Object(m["a"])(u,c,d,!1,null,"774c8e49",null),f=g.exports,C={components:{AiConfigDialog:f},props:{mindMap:{type:Object}},data(){return{aiInstance:null,isAiCreating:!1,aiCreatingContent:"",isLoopRendering:!1,uidMap:{},latestUid:"",clientTipDialogVisible:!1,createDialogVisible:!1,aiInput:"",aiCreatingMaskVisible:!1,aiConfigDialogVisible:!1,mindMapDataCache:"",beingAiCreateNodeUid:"",createPartDialogVisible:!1,aiPartInput:"",beingCreatePartNode:null}},computed:{...Object(l["c"])(["aiConfig"])},created(){this.$bus.$on("ai_create_all",this.aiCrateAll),this.$bus.$on("ai_create_part",this.showAiCreatePartDialog),this.$bus.$on("ai_chat",this.aiChat),this.$bus.$on("ai_chat_stop",this.aiChatStop),this.$bus.$on("showAiConfigDialog",this.showAiConfigDialog)},mounted(){document.body.appendChild(this.$refs.aiCreatingMaskRef)},beforeDestroy(){this.$bus.$off("ai_create_all",this.aiCrateAll),this.$bus.$off("ai_create_part",this.showAiCreatePartDialog),this.$bus.$off("ai_chat",this.aiChat),this.$bus.$off("ai_chat_stop",this.aiChatStop),this.$bus.$off("showAiConfigDialog",this.showAiConfigDialog)},methods:{showAiConfigDialog(){this.aiConfigDialogVisible=!0},async testConnect(){try{await fetch(`http://localhost:${this.aiConfig.port}/ai/test`,{method:"GET"}),this.$message.success(this.$t("ai.connectSuccessful")),this.clientTipDialogVisible=!1,this.createDialogVisible=!0}catch(e){console.log(e),this.$message.error(this.$t("ai.connectFailed"))}},async aiTest(){if(!(this.aiConfig.api&&this.aiConfig.key&&this.aiConfig.model&&this.aiConfig.port))throw this.showAiConfigDialog(),new Error(this.$t("ai.configurationMissing"));let e=!1;try{await fetch(`http://localhost:${this.aiConfig.port}/ai/test`,{method:"GET"}),e=!0}catch(t){console.log(t),this.clientTipDialogVisible=!0}if(!e)throw new Error(this.$t("ai.connectFailed"))},async aiCrateAll(){try{await this.aiTest(),this.createDialogVisible=!0}catch(e){console.log(e)}},closeAiCreateDialog(){this.createDialogVisible=!1,this.aiInput=""},doAiCreate(){const e=this.aiInput.trim();e?(this.closeAiCreateDialog(),this.aiCreatingMaskVisible=!0,this.isAiCreating=!0,this.aiInstance=new r["a"]({port:this.aiConfig.port}),this.aiInstance.init("huoshan",this.aiConfig),this.mindMap.renderer.setRootNodeCenter(),this.mindMap.setData(null),this.aiInstance.request({messages:[{role:"user",content:`${this.$t("ai.aiCreateMsgPrefix")}${e}${this.$t("ai.aiCreateMsgPostfix")}`}]},e=>{if(e){const t=e.split(/\n+/);this.aiCreatingContent=t.splice(0,t.length-1).join("\n")}this.loopRenderOnAiCreating()},e=>{this.aiCreatingContent=e,this.resetOnAiCreatingStop()},()=>{this.resetOnAiCreatingStop(),this.resetOnRenderEnd(),this.$message.error(this.$t("ai.generationFailed"))})):this.$message.warning(this.$t("ai.noInputTip"))},resetOnAiCreatingStop(){this.aiCreatingMaskVisible=!1,this.isAiCreating=!1,this.aiInstance=null},resetOnRenderEnd(){this.isLoopRendering=!1,this.uidMap={},this.aiCreatingContent="",this.mindMapDataCache="",this.beingAiCreateNodeUid=""},stopCreate(){this.aiInstance.stop(),this.isAiCreating=!1,this.aiCreatingMaskVisible=!1,this.$message.success(this.$t("ai.stoppedGenerating"))},loopRenderOnAiCreating(){if(!this.aiCreatingContent.trim()||this.isLoopRendering)return;this.isLoopRendering=!0;const e=Object(o["a"])(this.aiCreatingContent);this.addUid(e);let t=JSON.stringify(e);const i=()=>{if(this.checkNodeOuter(),!this.isAiCreating&&!this.aiCreatingContent)return this.mindMap.off("node_tree_render_end",i),void(this.latestUid="");const e=Object(o["a"])(this.aiCreatingContent);if(this.addUid(e),this.isAiCreating){const a=JSON.stringify(e);if(a===t)return void setTimeout(()=>{i()},500);t=a,this.mindMap.updateData(e)}else this.mindMap.updateData(e),this.resetOnRenderEnd(),this.$message.success(this.$t("ai.aiGenerationSuccess"))};this.mindMap.on("node_tree_render_end",i),this.mindMap.setData(e)},checkNodeOuter(){if(this.latestUid){const e=this.mindMap.renderer.findNodeByUid(this.latestUid);if(e){const{isOuter:t,offsetLeft:i,offsetTop:a}=Object(n["j"])(this.mindMap,e,100,100);t&&this.mindMap.view.translateXY(i,a)}}},addUid(e){const t={},i=(e,a="")=>{if(e.data||(e.data={}),Object(n["bb"])(e.data.uid)){const i=a+"-"+e.data.text;e.data.uid=this.uidMap[i]||Object(n["r"])(),t[e.data.uid]&&(e.data.uid=Object(n["r"])()),this.latestUid=this.uidMap[i]=e.data.uid,t[e.data.uid]=!0}e.children&&e.children.length>0&&e.children.forEach(t=>{i(t,e.data.uid)})};i(e)},showAiCreatePartDialog(e){this.beingCreatePartNode=e;const t=this.mindMap.getData();this.aiPartInput=`${this.$t("ai.aiCreatePartMsgPrefix")}${Object(n["N"])(t.data.text)}${this.$t("ai.aiCreatePartMsgCenter")}${Object(n["N"])(e.getData("text"))}${this.$t("ai.aiCreatePartMsgPostfix")}`,this.createPartDialogVisible=!0},closeAiCreatePartDialog(){this.createPartDialogVisible=!1},resetAiCreatePartDialog(){this.beingCreatePartNode=null,this.aiPartInput=""},confirmAiCreatePart(){this.aiPartInput.trim()&&(this.closeAiCreatePartDialog(),this.aiCreatePart())},async aiCreatePart(){try{if(!this.beingCreatePartNode)return;await this.aiTest(),this.beingAiCreateNodeUid=this.beingCreatePartNode.getData("uid");const e=this.mindMap.getData();this.mindMapDataCache=JSON.stringify(e),this.aiCreatingMaskVisible=!0,this.isAiCreating=!0,this.aiInstance=new r["a"]({port:this.aiConfig.port}),this.aiInstance.init("huoshan",this.aiConfig),this.aiInstance.request({messages:[{role:"user",content:this.aiPartInput.trim()+this.$t("ai.aiCreatePartMsgHelp")}]},e=>{if(e){const t=e.split(/\n+/);this.aiCreatingContent=t.splice(0,t.length-1).join("\n")}this.loopRenderOnAiCreatingPart()},e=>{this.aiCreatingContent=e,this.resetOnAiCreatingStop(),this.resetAiCreatePartDialog()},()=>{this.resetOnAiCreatingStop(),this.resetAiCreatePartDialog(),this.resetOnRenderEnd(),this.$message.error(this.$t("ai.generationFailed"))})}catch(e){console.log(e)}},addToTargetNode(e=[]){const t=JSON.parse(this.mindMapDataCache),i=t=>{if(t.data.uid===this.beingAiCreateNodeUid)return t.children||(t.children=[]),void t.children.push(...e);t.children&&t.children.length>0&&t.children.forEach(e=>{i(e)})};return i(t),t},loopRenderOnAiCreatingPart(){if(!this.aiCreatingContent.trim()||this.isLoopRendering)return;this.isLoopRendering=!0;const e=Object(o["a"])(this.aiCreatingContent);this.addUid(e);let t=JSON.stringify(e);const i=this.addToTargetNode(e.children||[]),a=()=>{if(this.checkNodeOuter(),!this.isAiCreating&&!this.aiCreatingContent)return this.mindMap.off("node_tree_render_end",a),void(this.latestUid="");const e=Object(o["a"])(this.aiCreatingContent);this.addUid(e);const i=this.addToTargetNode(e.children||[]);if(this.isAiCreating){const s=JSON.stringify(e);if(s===t)return void setTimeout(()=>{a()},500);t=s,this.mindMap.updateData(i)}else this.mindMap.updateData(i),this.resetOnRenderEnd(),this.$message.success(this.$t("ai.aiGenerationSuccess"))};this.mindMap.on("node_tree_render_end",a),this.mindMap.updateData(i)},async aiChat(e=[],t=(()=>{}),i=(()=>{}),a=(()=>{})){try{await this.aiTest(),this.isAiCreating=!0,this.aiInstance=new r["a"]({port:this.aiConfig.port}),this.aiInstance.init("huoshan",this.aiConfig),this.aiInstance.request({messages:e.map(e=>({role:"user",content:e}))},e=>{t(e)},e=>{i(e)},e=>{a(e)})}catch(s){console.log(s)}},aiChatStop(){this.aiInstance&&(this.aiInstance.stop(),this.isAiCreating=!1,this.aiInstance=null)}}},b=C,v=(i("e46b"),Object(m["a"])(b,a,s,!1,null,"118acd07",null));t["a"]=v.exports},"3be2":function(e,t,i){},"5fca":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container",class:{isDark:e.isDark,activeSidebar:e.activeSidebar}},[e.show?[e.isZenMode?e._e():t("Toolbar"),t("Edit")]:e._e()],2)},s=[],r=i("5651"),o=i("ac79"),n=i("2f62"),l=i("365c"),c={components:{Toolbar:r["a"],Edit:o["a"]},data(){return{show:!1}},computed:{...Object(n["c"])({isZenMode:e=>e.localConfig.isZenMode,isDark:e=>e.localConfig.isDark,activeSidebar:e=>e.activeSidebar})},watch:{isDark(){this.setBodyDark()}},async created(){this.initLocalConfig();const e=this.$loading({lock:!0,text:this.$t("other.loading")});this.show=!0,e.close(),this.setBodyDark()},methods:{...Object(n["b"])(["setLocalConfig"]),initLocalConfig(){let e=Object(l["d"])();e&&this.setLocalConfig({...this.$store.state.localConfig,...e})},setBodyDark(){this.isDark?document.body.classList.add("isDark"):document.body.classList.remove("isDark")}}},d=c,p=(i("db40"),i("2877")),h=Object(p["a"])(d,a,s,!1,null,null,null);t["default"]=h.exports},7066:function(e,t,i){"use strict";var a=function(){var e,t=this,i=t._self._c;return i("Sidebar",{ref:"sidebar",attrs:{title:t.$t("ai.chatTitle")}},[i("div",{staticClass:"aiChatBox",class:{isDark:t.isDark}},[i("div",{staticClass:"provider-info",class:{"has-error":t.hasError}},[i("span",{staticClass:"provider-name"},[i("i",{staticClass:"el-icon-cpu"}),t._v(" "+t._s(t.currentProviderName)+" "),t.aiConfig.model?i("span",{staticClass:"model-name"},[t._v("("+t._s(t.aiConfig.model)+")")]):t._e()]),t.isCreating?i("span",{staticClass:"status"},[i("i",{staticClass:"el-icon-loading"}),t._v(" "+t._s(t.$t("ai.generating"))+" ")]):t._e(),t.errorMessage?i("span",{staticClass:"error-msg"},[i("i",{staticClass:"el-icon-warning-outline"}),t._v(" "+t._s(t.errorMessage)+" ")]):t._e()]),i("div",{staticClass:"chatHeader"},[i("el-button",{attrs:{size:"mini",disabled:t.isCreating},on:{click:t.clear}},[i("i",{staticClass:"el-icon-delete"}),t._v(" "+t._s(t.$t("ai.clearRecords"))+" ")]),i("el-button",{attrs:{size:"mini",disabled:t.isCreating},on:{click:t.modifyAiConfig}},[i("i",{staticClass:"el-icon-setting"}),t._v(" "+t._s(t.$t("ai.settings"))+" ")])],1),i("div",{ref:"chatResBoxRef",staticClass:"chatResBox customScrollbar"},[0===t.chatList.length?i("div",{staticClass:"welcome-message"},[i("div",{staticClass:"welcome-content"},[i("div",{staticClass:"welcome-icon"},[i("i",{staticClass:"el-icon-chat-dot-round"})]),i("h3",[t._v(t._s(t.$t("ai.welcomeTitle")))]),i("p",[t._v(t._s(t.$t("ai.welcomeSubtitle")))]),i("div",{staticClass:"suggestions"},t._l(t.suggestions,(function(e,a){return i("el-button",{key:a,attrs:{size:"small"},on:{click:function(i){return t.useSuggestion(e)}}},[t._v(" "+t._s(e)+" ")])})),1)])]):t._l(t.chatList,(function(e){return i("div",{key:e.id,staticClass:"chatItem",class:[e.type]},["user"===e.type?i("div",{staticClass:"chatItemInner"},[i("div",{staticClass:"avatar user-avatar"},[i("i",{staticClass:"el-icon-user"})]),i("div",{staticClass:"content"},[i("div",{staticClass:"message-text"},[t._v(t._s(e.content))]),i("div",{staticClass:"message-time"},[t._v(t._s(t.formatTime(e.time)))])])]):"ai"===e.type?i("div",{staticClass:"chatItemInner"},[i("div",{staticClass:"avatar ai-avatar"},[i("i",{staticClass:"el-icon-cpu"})]),i("div",{staticClass:"content"},[i("div",{staticClass:"message-text",domProps:{innerHTML:t._s(e.content)}}),i("div",{staticClass:"message-time"},[t._v(" "+t._s(t.formatTime(e.time))+" "),i("span",{staticClass:"copy-btn",on:{click:function(i){return t.copyToClipboard(e.content)}}},[i("i",{staticClass:"el-icon-document-copy"}),t._v(" "+t._s(t.$t("ai.copy"))+" ")])])])]):t._e()])})),t.isCreating&&"ai"===(null===(e=t.chatList[t.chatList.length-1])||void 0===e?void 0:e.type)?i("div",{staticClass:"typing-indicator"},[i("div",{staticClass:"typing-dot"}),i("div",{staticClass:"typing-dot"}),i("div",{staticClass:"typing-dot"})]):t._e()],2),i("div",{staticClass:"chatInputBox",class:{"has-error":t.hasError}},[i("div",{staticClass:"input-wrapper"},[i("el-input",{attrs:{type:"textarea",rows:3,resize:"none",placeholder:t.$t("ai.chatInputPlaceholder"),disabled:t.isCreating},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleKeydown.apply(null,arguments)}},model:{value:t.text,callback:function(e){t.text=e},expression:"text"}}),i("div",{staticClass:"input-actions"},[t.isCreating?t._e():i("span",{staticClass:"hint"},[t._v(" "+t._s(t.$t("ai.pressEnterToSend"))+" ")]),i("el-button",{staticClass:"send-btn",attrs:{type:"primary",size:"small",loading:t.isCreating,disabled:!t.text.trim()},on:{click:t.send}},[t._v(" "+t._s(t.isCreating?t.$t("ai.generating"):t.$t("ai.send"))+" "),i("i",{staticClass:"send-icon",class:t.isCreating?"el-icon-loading":"el-icon-position"})])],1)],1),i("div",{staticClass:"disclaimer"},[t._v(" "+t._s(t.$t("ai.disclaimer"))+" ")])])])])},s=[],r=(i("d9e2"),i("14d9"),i("0643"),i("2382"),i("a573"),i("62a5")),o=i("2f62"),n=i("d17d"),l=i("d4cd"),c=i.n(l),d=i("677d");let p=null;var h={name:"AiChat",components:{Sidebar:r["a"]},data(){return{text:"",chatList:[],isCreating:!1,errorMessage:"",suggestions:[this.$t("ai.suggestions.help"),this.$t("ai.suggestions.summarize"),this.$t("ai.suggestions.brainstorm")]}},computed:{...Object(o["c"])({isDark:e=>e.localConfig.isDark,activeSidebar:e=>e.activeSidebar,aiConfig:e=>e.localConfig.aiConfig||{}}),currentProviderName(){const e=this.aiConfig.provider||"volcano",t=d["b"][e]||{};return t.name||this.$t("ai.unknownProvider")},hasError(){return!!this.errorMessage}},watch:{activeSidebar(e){this.$refs.sidebar.show="ai"===e,"ai"===e&&this.scrollToBottom()},chatList:{handler(){this.$nextTick(()=>{this.scrollToBottom()})},deep:!0}},created(){p=new c.a({html:!0,linkify:!0,typographer:!0}),this.loadChatHistory(),this.$bus.$on("ai_chat",this.handleAiChat),this.$bus.$on("ai_chat_stop",this.handleAiChatStop)},beforeDestroy(){this.$bus.$off("ai_chat",this.handleAiChat),this.$bus.$off("ai_chat_stop",this.handleAiChatStop)},methods:{handleKeydown(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),this.send())},formatTime(e){if(!e)return"";const t=new Date(e);return t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},async copyToClipboard(e){try{const t=e.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(t),this.$message.success(this.$t("ai.copiedToClipboard"))}catch(t){console.error("Failed to copy text:",t),this.$message.error(this.$t("ai.copyFailed"))}},useSuggestion(e){this.text=e,this.$nextTick(()=>{const e=this.$el.querySelector("textarea");e&&e.focus()})},scrollToBottom(){this.$refs.chatResBoxRef&&(this.$refs.chatResBoxRef.scrollTop=this.$refs.chatResBoxRef.scrollHeight)},saveChatHistory(){try{localStorage.setItem("aiChatHistory",JSON.stringify(this.chatList))}catch(e){console.error("Failed to save chat history:",e)}},loadChatHistory(){try{const e=localStorage.getItem("aiChatHistory");e&&(this.chatList=JSON.parse(e))}catch(e){console.error("Failed to load chat history:",e)}},async send(){if(this.isCreating)return;const e=this.text.trim();if(!e)return;this.errorMessage="";const t={id:Object(n["r"])(),type:"user",content:e,time:Date.now()},i={id:Object(n["r"])(),type:"ai",content:"",time:Date.now()};this.chatList=[...this.chatList,t,i],this.text="",this.isCreating=!0;try{const t=this.prepareMessages(e);this.$bus.$emit("ai_chat",{provider:this.aiConfig.provider||"volcano",model:this.aiConfig.model,messages:t,onData:e=>{const t=this.chatList[this.chatList.length-1];t&&"ai"===t.type&&(t.content=p.render(e),t.time=Date.now(),this.$forceUpdate())},onComplete:()=>{this.isCreating=!1,this.saveChatHistory()},onError:e=>{this.isCreating=!1,this.errorMessage=e.message||this.$t("ai.generationFailed"),this.$message.error(this.errorMessage)}})}catch(a){console.error("Error sending message:",a),this.isCreating=!1,this.errorMessage=a.message||this.$t("ai.unexpectedError"),this.$message.error(this.errorMessage)}},prepareMessages(e){const t=this.chatList.filter(e=>"user"===e.type||"ai"===e.type).map(e=>({role:"user"===e.type?"user":"assistant",content:e.content.replace(/<[^>]*>/g,"")}));return t.push({role:"user",content:e}),t},handleAiChat(e){const{provider:t="volcano",model:i="",messages:a=[],onData:s,onComplete:r,onError:o}=e,n=this.$store.state.localConfig.aiConfig||{},l={provider:t,model:i||n.model,apiKey:n.apiKey,messages:a.map(e=>({role:e.role,content:e.content})),temperature:n.temperature,maxTokens:n.maxTokens,topP:n.topP,presencePenalty:n.presencePenalty,frequencyPenalty:n.frequencyPenalty};this.$http.post("/api/ai/chat",l,{responseType:"stream",onDownloadProgress:e=>{const t=e.target.response,i=t.split("\n").filter(e=>""!==e.trim());for(const o of i)try{const e=o.replace(/^data: /,"").trim();if("[DONE]"===e)return void(r&&r());const t=JSON.parse(e);if(t.choices&&t.choices[0].delta.content){const e=t.choices[0].delta.content;s&&s(e)}}catch(a){console.error("Error parsing SSE message:",a)}}}).catch(e=>{var t;console.error("AI API error:",e);const i=(null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t||null===(t=t.error)||void 0===t?void 0:t.message)||e.message||this.$t("ai.generationFailed");o&&o(new Error(i))})},handleAiChatStop(){this.currentRequest&&(this.currentRequest.abort(),this.currentRequest=null),this.isCreating=!1},clear(){this.$confirm(this.$t("ai.clearChatConfirm"),this.$t("common.tip"),{confirmButtonText:this.$t("common.confirm"),cancelButtonText:this.$t("common.cancel"),type:"warning"}).then(()=>{this.chatList=[],localStorage.removeItem("aiChatHistory"),this.$message({type:"success",message:this.$t("ai.chatCleared")})}).catch(()=>{})},modifyAiConfig(){this.$bus.$emit("showAiConfigDialog")}}},u=h,m=(i("b385"),i("2877")),g=Object(m["a"])(u,a,s,!1,null,"aab31510",null);t["a"]=g.exports},"7c5d":function(e,t,i){},b385:function(e,t,i){"use strict";i("7c5d")},d767:function(e,t,i){},db40:function(e,t,i){"use strict";i("3be2")},e313:function(e,t,i){"use strict";i("d767")},e46b:function(e,t,i){"use strict";i("11c8")}}]);