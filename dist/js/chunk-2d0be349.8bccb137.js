(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0be349"],{"2eee":function(t,e,i){"use strict";var s=i("d2b6"),h=i("ff0d"),a=i("ce3a"),n=i("586a"),o=i.n(n),r=i("97e7"),d=i("a751"),l=i("7cc28"),c=i("36fa"),m=i("685d"),p=i("6ac9"),g=i("6682"),u=i("d17d"),f=i("989e"),w=i("2689");class C{constructor(t={}){if(C.instanceCount++,this.opt=this.handleOpt(o()(w["a"],t)),this.opt.data=this.handleData(this.opt.data),this.el=this.opt.el,!this.el)throw new Error("缺少容器元素el");this.getElRectInfo(),this.initWidth=this.width,this.initHeight=this.height,this.cssEl=null,this.cssTextMap={},this.nodeInnerPrefixList=[],this.nodeInnerPostfixList=[],this.editNodeClassList=[],this.extendShapeList=[],this.initContainer(),this.initTheme(),this.initCache(),C.pluginList.filter(t=>t.preload).forEach(t=>{this.initPlugin(t)}),this.event=new h["a"]({mindMap:this}),this.keyCommand=new l["a"]({mindMap:this}),this.command=new c["a"]({mindMap:this}),this.renderer=new a["a"]({mindMap:this}),this.view=new s["a"]({mindMap:this}),this.batchExecution=new m["a"],C.pluginList.filter(t=>!t.preload).forEach(t=>{this.initPlugin(t)}),this.addCss(),this.render(this.opt.fit?()=>this.view.fit():()=>{}),this.opt.addHistoryOnInit&&this.opt.data&&this.command.addHistory()}handleOpt(t){return p["e"].includes(t.layout)||(t.layout=p["a"].LAYOUT.LOGICAL_STRUCTURE),t.theme=t.theme&&r["a"][t.theme]?t.theme:"default",t}handleData(t){return Object(u["bb"])(t)||Object.keys(t).length<=0?null:(t=Object(u["tb"])(t||{}),t.data&&!t.data.expand&&(t.data.expand=!0),Object(u["s"])([t],!1,null,!0),t)}initContainer(){const{associativeLineIsAlwaysAboveNode:t}=this.opt;this.el.classList.add("smm-mind-map-container");const e=()=>{this.associativeLineDraw=this.draw.group(),this.associativeLineDraw.addClass("smm-associative-line-container")};this.svg=Object(g["i"])().addTo(this.el).size(this.width,this.height),this.draw=this.svg.group(),this.draw.addClass("smm-container"),this.lineDraw=this.draw.group(),this.lineDraw.addClass("smm-line-container"),t||e(),this.nodeDraw=this.draw.group(),this.nodeDraw.addClass("smm-node-container"),t&&e(),this.otherDraw=this.draw.group(),this.otherDraw.addClass("smm-other-container")}clearDraw(){this.lineDraw.clear(),this.associativeLineDraw.clear(),this.nodeDraw.clear(),this.otherDraw.clear()}appendCss(t,e){this.cssTextMap[t]=e,this.removeCss(),this.addCss()}removeAppendCss(t){this.cssTextMap[t]&&(delete this.cssTextMap[t],this.removeCss(),this.addCss())}joinCss(){return p["c"]+Object.keys(this.cssTextMap).map(t=>this.cssTextMap[t]).join("\n")}addCss(){this.cssEl=document.createElement("style"),this.cssEl.type="text/css",this.cssEl.innerHTML=this.joinCss(),document.head.appendChild(this.cssEl)}removeCss(){this.cssEl&&document.head.removeChild(this.cssEl)}checkEditNodeClassIndex(t){return this.editNodeClassList.findIndex(e=>e===t)}addEditNodeClass(t){const e=this.checkEditNodeClassIndex(t);-1===e&&this.editNodeClassList.push(t)}deleteEditNodeClass(t){const e=this.checkEditNodeClassIndex(t);-1!==e&&this.editNodeClassList.splice(e,1)}render(t,e=""){this.initTheme(),this.renderer.render(t,e)}reRender(t,e=""){this.renderer.reRender=!0,this.renderer.clearCache(),this.clearDraw(),this.render(t,e)}getElRectInfo(){if(this.elRect=this.el.getBoundingClientRect(),this.width=this.elRect.width,this.height=this.elRect.height,this.width<=0||this.height<=0)throw new Error("容器元素el的宽高不能为0")}resize(){const t=this.width,e=this.height;this.getElRectInfo(),this.svg.size(this.width,this.height),t===this.width&&e===this.height||this.demonstrate&&this.demonstrate.isInDemonstrate||this.render(),this.emit("resize")}on(t,e){this.event.on(t,e)}emit(t,...e){this.event.emit(t,...e)}off(t,e){this.event.off(t,e)}initCache(){this.commonCaches={measureCustomNodeContentSizeEl:null,measureRichtextNodeTextSizeEl:null}}initTheme(){this.themeConfig=Object(u["eb"])(r["a"][this.opt.theme]||r["a"].default,this.opt.themeConfig),d["a"].setBackgroundStyle(this.el,this.themeConfig)}setTheme(t,e=!1){this.execCommand("CLEAR_ACTIVE_NODE"),this.opt.theme=t,e||this.render(null,p["a"].CHANGE_THEME),this.emit("view_theme_change",t)}getTheme(){return this.opt.theme}setThemeConfig(t,e=!1){const i=Object(u["L"])(this.themeConfig,t);if(this.opt.themeConfig=t,!e){const t=Object(f["a"])(i);this.render(null,t?"":p["a"].CHANGE_THEME)}}getCustomThemeConfig(){return this.opt.themeConfig}getThemeConfig(t){return void 0===t?this.themeConfig:this.themeConfig[t]}getConfig(t){return void 0===t?this.opt:this.opt[t]}updateConfig(t={}){this.emit("before_update_config",this.opt);const e={...this.opt};this.opt=this.handleOpt(o.a.all([w["a"],this.opt,t])),this.emit("after_update_config",this.opt,e)}getLayout(){return this.opt.layout}setLayout(t,e=!1){p["e"].includes(t)||(t=p["a"].LAYOUT.LOGICAL_STRUCTURE),this.opt.layout=t,this.view.reset(),this.renderer.setLayout(),e||this.render(null,p["a"].CHANGE_LAYOUT),this.emit("layout_change",t)}execCommand(...t){this.command.exec(...t)}updateData(t){t=this.handleData(t),this.emit("before_update_data",t),this.renderer.setData(t),this.render(),this.command.addHistory(),this.emit("update_data",t)}setData(t){t=this.handleData(t),this.emit("before_set_data",t),this.opt.data=t,this.execCommand("CLEAR_ACTIVE_NODE"),this.command.clearHistory(),this.command.addHistory(),this.renderer.setData(t),this.reRender(),this.emit("set_data",t)}setFullData(t){t.root&&this.setData(t.root),t.layout&&this.setLayout(t.layout),t.theme&&(t.theme.template&&this.setTheme(t.theme.template),t.theme.config&&this.setThemeConfig(t.theme.config)),t.view&&this.view.setTransformData(t.view)}getData(t){let e=this.command.getCopyData(),i={};return i=t?{layout:this.getLayout(),root:e,theme:{template:this.getTheme(),config:this.getCustomThemeConfig()},view:this.view.getTransformData()}:e,Object(u["tb"])(i)}async export(...t){try{if(!this.doExport)throw new Error("请注册Export插件！");let e=await this.doExport.export(...t);return e}catch(e){this.opt.errorHandler(p["b"].EXPORT_ERROR,e)}}toPos(t,e){return{x:t-this.elRect.left,y:e-this.elRect.top}}setMode(t){if(![p["a"].MODE.READONLY,p["a"].MODE.EDIT].includes(t))return;const e=t===p["a"].MODE.READONLY;e!==this.opt.readonly&&(e&&(this.renderer.textEdit.isShowTextEdit()&&(this.renderer.textEdit.hideEditTextBox(),this.command.originAddHistory()),this.execCommand("CLEAR_ACTIVE_NODE")),this.opt.readonly=e,!e&&this.command.history.length<=0&&this.command.originAddHistory(),this.emit("mode_change",t))}getSvgData({paddingX:t=0,paddingY:e=0,ignoreWatermark:i=!1,addContentToHeader:s,addContentToFooter:h,node:a}={}){const{watermarkConfig:n,openPerformance:o}=this.opt;o&&this.renderer.forceLoadNode(a);const{cssTextList:r,header:d,headerHeight:l,footer:c,footerHeight:m}=Object(u["S"])({addContentToHeader:s,addContentToFooter:h}),p=this.svg,f=this.draw,w=p.width(),C=p.height(),E=f.transform(),x=this.elRect;f.scale(1/E.scaleX,1/E.scaleY);const T=f.rbox();let L=null;a&&(L=Object(u["K"])(a,T.x,T.y,t,e));const v=0;T.width+=2*t,T.height+=2*e+v+l+m,f.translate(t,e),p.size(T.width,T.height),f.translate(-T.x+x.left,-T.y+x.top);let y=p.clone();const D=this.watermark&&this.watermark.hasWatermark();if(!i&&D){this.watermark.isInExport=!0;const{onlyExport:t}=n,e=T.width>w||T.height>C;e?(this.width=T.width,this.height=T.height,this.watermark.onResize(),y=p.clone(),this.width=w,this.height=C,this.watermark.onResize()):t&&(this.watermark.onResize(),y=p.clone()),t&&this.watermark.clear(),this.watermark.isInExport=!1}[this.joinCss(),...r].forEach(t=>{y.add(Object(g["i"])(`<style>${t}</style>`))}),d&&l>0&&(y.findOne(".smm-container").translate(0,l),d.width(T.width),d.y(e),y.add(d,0)),c&&m>0&&(c.width(T.width),c.y(T.height-e-m),y.add(c));const b=p.find("defs"),O=y.find("defs");return b.forEach((t,e)=>{const i=O[e];if(!i)return;const s=t.children(),h=i.children();for(let a=0;a<s.length;a++){const t=s[a],e=h[a];t&&e&&e.attr("id",t.attr("id"))}}),p.size(w,C),f.transform(E),{svg:y,svgHTML:y.svg(),clipData:L,rect:{...T,ratio:T.width/T.height},origWidth:w,origHeight:C,scaleX:E.scaleX,scaleY:E.scaleY}}addShape(t){if(!t)return;const e=this.extendShapeList.find(e=>e.name===t.name);e||this.extendShapeList.push(t)}removeShape(t){const e=this.extendShapeList.findIndex(e=>e.name===t);-1!==e&&this.extendShapeList.splice(e,1)}getSvgObjects(){return{SVG:g["i"],G:g["d"],Rect:g["h"]}}addPlugin(t,e){let i=C.hasPlugin(t);-1===i&&C.usePlugin(t,e),this.initPlugin(t)}removePlugin(t){let e=C.hasPlugin(t);-1!==e&&(C.pluginList.splice(e,1),this[t.instanceName]&&(this[t.instanceName].beforePluginRemove&&this[t.instanceName].beforePluginRemove(),delete this[t.instanceName]))}initPlugin(t){this[t.instanceName]||(this[t.instanceName]=new t({mindMap:this,pluginOpt:t.pluginOpt}))}destroy(){this.emit("beforeDestroy"),this.renderer.textEdit.hideEditTextBox(),this.renderer.textEdit.removeTextEditEl(),[...C.pluginList].forEach(t=>{this[t.instanceName]&&this[t.instanceName].beforePluginDestroy&&this[t.instanceName].beforePluginDestroy(),this[t.instanceName]=null}),this.event.unbind(),this.svg.remove(),d["a"].removeBackgroundStyle(this.el),this.el.classList.remove("smm-mind-map-container"),this.el.innerHTML="",this.el=null,this.removeCss(),C.instanceCount--}}let E=[];C.extendNodeDataNoStylePropList=(t=[])=>{E.push(...t),p["f"].push(...t)},C.resetNodeDataNoStylePropList=()=>{E.forEach(t=>{const e=p["f"].findIndex(e=>e===t);-1!==e&&p["f"].splice(e,1)}),E=[]},C.pluginList=[],C.usePlugin=(t,e={})=>(-1!==C.hasPlugin(t)||(t.pluginOpt=e,C.pluginList.push(t)),C),C.hasPlugin=t=>C.pluginList.findIndex(e=>e===t),C.instanceCount=0,C.defineTheme=(t,e={})=>{if(r["a"][t])return new Error("该主题名称已存在");r["a"][t]=Object(u["eb"])(f["b"],e)},C.removeTheme=t=>{r["a"][t]&&(r["a"][t]=null)},e["a"]=C}}]);