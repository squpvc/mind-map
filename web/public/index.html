<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <link rel="icon" href="dist/logo.ico" />
    <title>Thoughts Mind Map</title>
    <script>
      // Custom static resource path
      window.externalPublicPath = './dist/'
      // Take over application
      window.takeOverApp = false
    </script>
    <script
      charset="UTF-8"
      id="LA_COLLECT"
      src="https://sdk.51.la/js-sdk-pro.min.js"
    ></script>
    <script>
      try {
        LA.init({
          id: 'KRO0WxK8GT66tYCQ',
          ck: 'KRO0WxK8GT66tYCQ',
          autoTrack: false
        })
      } catch (error) {
        console.log(error)
      }
    </script>
  </head>
  <body>
    <noscript>
      <strong
        >We're sorry but <%= htmlWebpackPlugin.options.title %> doesn't work
        properly without JavaScript enabled. Please enable it to
        continue.</strong
      >
    </noscript>
    <div id="app"></div>
    <!-- built files will be auto injected -->
    <script>
      const getDataFromBackend = () => {
        return new Promise((resolve, reject) => {
          setTimeout(() => {
            resolve({
              mindMapData: {
                root: {
                  data: {
                    text: 'Root Node'
                  },
                  children: []
                },
                theme: {
                  template: 'avocado',
                  config: {}
                },
                layout: 'logicalStructure',
                config: {},
                view: null
              },
              mindMapConfig: {},
              lang: 'zh',
              localConfig: null
            })
          }, 200)
        })
      }
      const setTakeOverAppMethods = data => {
        window.takeOverAppMethods = {}
        // Function to get mind map data
        window.takeOverAppMethods.getMindMapData = () => {
          return data.mindMapData
        }
        // Function to save mind map data
        window.takeOverAppMethods.saveMindMapData = data => {
          console.log(data)
        }
        // Function to get mind map configuration, which are the options passed during instantiation
        window.takeOverAppMethods.getMindMapConfig = () => {
          return data.mindMapConfig
        }
        // Save mind map configuration
        window.takeOverAppMethods.saveMindMapConfig = config => {
          console.log(config)
        }
        // Function to get language
        window.takeOverAppMethods.getLanguage = () => {
          return data.lang
        }
        // Function to save language
        window.takeOverAppMethods.saveLanguage = lang => {
          console.log(lang)
        }
        // Function to get local configuration
        window.takeOverAppMethods.getLocalConfig = () => {
          return data.localConfig
        }
        // Function to save local configuration
        window.takeOverAppMethods.saveLocalConfig = config => {
          console.log(config)
        }
      }
      window.onload = async () => {
        if (!window.takeOverApp) return
        // Request data
        const data = await getDataFromBackend()
        // Set global methods
        setTakeOverAppMethods(data)
        // Mind map instance creation completion event
        window.$bus.$on('app_inited', mindMap => {
          console.log(mindMap)
        })
        // You can use window.$bus.$on() to listen to application events
        // Instantiate the page
        window.initApp()
      }
    </script>
  </body>
</html>